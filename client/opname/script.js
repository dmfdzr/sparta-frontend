/* ======================== CONSTANTS & UTILS ======================== */
const API_BASE_URL = "https://opnamebnm-mgbe.onrender.com"; 
const INACTIVITY_LIMIT_MS = 60 * 60 * 1000; // 1 Jam

// Format Rupiah
const formatRupiah = (number) => {
    const numericValue = Number(number) || 0;
    return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    }).format(numericValue);
};

// Convert string/number to clean number
const toNumInput = (v) => {
    if (v === null || v === undefined) return 0;
    const s = String(v).trim().replace(",", ".");
    const n = Number(s);
    return Number.isFinite(n) ? n : 0;
};

const toNumID = (v) => {
    if (v === null || v === undefined) return 0;
    const s = String(v).trim();
    const cleaned = s.replace(/[^\d,.-]/g, "");
    const normalized = cleaned.replace(/\./g, "").replace(",", ".");
    const n = Number(normalized);
    return Number.isFinite(n) ? n : 0;
};

/* ======================== STATE MANAGEMENT ======================== */
const AppState = {
    user: null,
    loading: true,
    activeView: 'dashboard',
    selectedStore: null,
    selectedUlok: null,
    selectedLingkup: null,
    opnameItems: [],
    stores: [],
    uloks: [],
    idleTimer: null,
};

/* ======================== AUTH SYSTEM (INTEGRATED) ======================== */
const Auth = {
    init: async () => {
        const savedUser = sessionStorage.getItem("user");
        const mainAuthEmail = sessionStorage.getItem("loggedInUserEmail");
        const mainAuthCabang = sessionStorage.getItem("loggedInUserCabang");

        if (savedUser) {
            try {
                AppState.user = JSON.parse(savedUser);
                Auth.startIdleTimer();
            } catch {
                sessionStorage.removeItem("user");
            }
        } 
        else if (mainAuthEmail && mainAuthCabang) {
            console.log("Mendeteksi sesi Sparta Utama. Mencoba login otomatis ke Opname...");
            try {
                // Mencoba login menggunakan data dari Session Storage (Integrasi)
                const result = await Auth.login(mainAuthEmail, mainAuthCabang);
                if (result.success) {
                    console.log("Auto-login Opname berhasil.");
                } else {
                    console.warn("Auto-login Opname gagal:", result.message);
                }
            } catch (e) {
                console.error("Kesalahan saat auto-login:", e);
            }
        }

        AppState.loading = false;
        Render.app();
    },

    login: async (username, password) => {
        try {
            const now = new Date();
            const wibTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Jakarta" }));
            const hour = wibTime.getHours();
            
            if (hour < 6 || hour >= 24) {
                const currentTime = wibTime.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit" });
                throw new Error(`Sesi habis. Login 06.00â€“24.00 WIB. (Saat ini: ${currentTime})`);
            }

            const res = await fetch(`${API_BASE_URL}/api/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password }),
            });
            const userData = await res.json();
            if (!res.ok) throw new Error(userData.message || "Login failed");

            AppState.user = userData;
            sessionStorage.setItem("user", JSON.stringify(userData));
            Auth.startIdleTimer();
            return { success: true };
        } catch (error) {
            return { success: false, message: error.message };
        }
    },

    logout: () => {
        AppState.user = null;
        sessionStorage.removeItem("user");
        clearTimeout(AppState.idleTimer);
        AppState.activeView = 'dashboard';
        AppState.selectedStore = null;

        // Redirect ke Dashboard Utama karena tidak ada login page lokal
        window.location.href = "../../dashboard/index.html";
    },

    startIdleTimer: () => {
        clearTimeout(AppState.idleTimer);
        AppState.idleTimer = setTimeout(() => Auth.logout(), INACTIVITY_LIMIT_MS);
        window.onclick = () => { 
            if(AppState.user) { 
                clearTimeout(AppState.idleTimer); 
                AppState.idleTimer = setTimeout(() => Auth.logout(), INACTIVITY_LIMIT_MS); 
            }
        };
    }
};

/* ======================== PDF HELPER FUNCTIONS ======================== */
const COMPANY_NAME = "PT. SUMBER ALFARIA TRIJAYA, Tbk";
const REPORT_TITLE = "BERITA ACARA OPNAME PEKERJAAN";
const LOGO_URL_FALLBACK = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAADwAAAAhwBAMAAABikNZBAAAAGFBMVEVHcEzqHC0DXab/////0gD+qqL74956n8q4u2LQAAAAAXRSTlMAQObYZgAAIABJREFUeNrswQEBAAAAgJD+r+4ICgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIDZu7fbyHEoCKBgBuoPbiILOw+jISUgtPIPYeydANb9Kj50zgL7P7gGCnVJsQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKCpcgGAgEXmil8AmpC7//GHAIAI1nsBEMHiFwBEsPgFYCqL8AUALVj8AiCBxS8AvM1ZttAmDYAKLH4BQPwCQAOL+AUACezmFQAnIX4BQAUWvwBIYGe/APA24hcAJLD4BeAkFoe/ACCAxS8A5yB+AUAFdvoLgAAWvwDwLuIXAFRg8QuACuz2FQAIYP0XgIks4hcAVGDrZwBUYP0XAASw+AVgItbPAKACy18ABLD4BYB3cf4LAAJY/gIggO2fAeBNFvkLAAJY/gIggB3/AsDZA1j/BWAm8hcABLD9MwACWP8FgDMHsPwFQADbPwPA0xb1FwAEsP4LgACWvwBwzgA2IQDm5AAYAASw/AVAANs/A8D5Alj/BWBei/wFAAFsAQ2AAJa/AHCuAC5GA8DU9F8AEMD6LwACWP4CwIkCOPDPruuPv/8HgDf4Gi6AM+G7ff93/AsA7/H5PwG8nGoB/Td6P/1ZACCAU/n7Hb3H9tN5d38VAAjgUP6u2zd/DgCkfAwWwG869JW9AGjA0fz9Dt9j93cAgABOLqDreruJXwAaBPBloAAur2+//gIA0ICjC+ifW8/mD4AAzhbg9XZcjR+AZgE8zgq6vPTodzd7ADTg6AK6euwKAAGczt9aN2e/ALQ2zEMc5WVnv24+A6ABh/N3XXczB0AAZxfQX+th+wxAFwZZQb/m9PfY9F8ANODsArquq3EDIICzBbjW41B/AegngEd4iOMF/denRwBowPEFtGefARDA8QL88/LVbtQAdBXA/a+gn87fzdMbAGjA6QW0y88ACOB4Aa5OfwHoUfcPcTzbf+UvABpwegFdPf0MgACOF+B19bu/APSp8xX0c/33Zv8MgAacXkDfrsYLgAAOF2DHvwB0HcA9P8RRnsnfm+ECoAHH89frVwAI4PQCWvwC0HsA97uCfub1591kAdCAwwvoqv8CIIDjBXi9GisAvev2IY7y+PnvbqwAaMDhAmz/DIAAzhdg958BGEKnK2j5C4AGPM4Cum67kQIggMMF2PkvAMMEcJcPcfj+CAANeJQCXI/dPAEQwOECbP8MwEgB3OEK+qEC7Pd/AdCAGxRgv/8LgADOF2AfAAMwlP4e4ngsf/fdLAHQgMML6Gr/DIAAjhdgF6ABGE13K+iHLkCbIwAacLwAr4c5AiCA4/m7GyMAwwVwXw9xyF8ANOB8ABcfAAMggPMB7AVKAM4SwD2toIsPkADQgPMB7CeAARDA+QBWgAE4jZ4e4tB/AdCA8wF8dwGu1fwAEMDxArx5AQuAUfWzgi5e4ABAA84H8N0L6H8EMAACOF6ALaABGDmAe3mIwwIaAA04H8DFE9AACOB8ACvAAJwrgPtYQSvAAGjADQLYE1gACOB8AJd7n4DeTQ6AofXxEIcCDIAGnA/gewuw/guAAM4XYBewABheDyvo4gskADTgfAD7AgkAAdx/ACvAAEwQwO0f4rhvA70pwABowPECXK9mBoAAjhdgC2gA5gjg5itoN7AA0IDzAXxXAa6riQEggBVgAHjMx0gBXLfdxADQgNMbaP0XAAGcL8BuQAMwjcYraAUYAA24QQArwAAI4HwAFzegAThpAF+GCWAFGAANOL6BrgowAAJYAQaApwK45Qr6ngJ8mBUAGnC8AF+NCgABHC/AfoQBgLk0fIijuIEFgAacD2AFGAABnA/gewrw1aAAmMvHCAHsEyQANOD8BtoJMAACuEUBNiYApgvgS/cBrAADoAE32EA7AQZAAOcL8Ho1JQDmC+BGK+jfL6CrIQGgAecD2K8wACCA4xvo6go0ADNq9BDHrwvwlyvQAGjADa5gGREAAjh/Anw1IgBm9NF1ADsBBkADbnEFywkwAAI4v4FWgAGYNYAvHQdwvRoQABpwfAPtFWgABHCDAuwEGIBpAzi/gi5OgAEQwF/dBrACDIAAbrCBVoABmFf+IY7iCjQAfPYbwLvpACCA4xtoBRiAicVX0MUJMADkG7CfYQCAjgPYN0gATB3A4Yc4ilcoASDfgBVgAOg3gBVgACYP4OwKuijAAJBvwL/9CNhgABDAf9i7nx23bTUM45g7qBfTC/Ai3h/A0nUUA2efGmPtZWB4+8eZ0xwEzZ+xJfGjSP0etGjaRUrTGT18P36k4luwBGAAQOMc1yhgt1ACACTgAhVoARgAQMBasAAAWJzjCgV8ImAAgAQcXoF2DTQAgID/KFCBfvG1AACaF/BudQIWgAEAEvAf8RVoARgAQMDxAnYNNABgCwKOK0E/OQQMAEB8AnYGCQCA9Qr47EsBALTPcWUCdgsWAEACXlTAT97DAABAvIC1YAEA8H+O6xKwAAwAkIAXFfCTAAwAQLyAtWABAPCdgHcEDABAswn4yXsYAACIF7D3MAAA8L2Ad2sSsO8DACABLyng+yrQAjAAgIDjBawFCwCwGYIu4lCBBgAgPgG7hQMAgLUK2DWUAIDtEFOC9iZgAAAKJGC3cAAAsFIBq0ADALYk4IiLOO7aAv5MwAAACXhRAeuBBgBgpQJ+fvFlAAA2JOCAEvSTHmgAAOIT8JNrKAEAiBewHmgAAP7FcSUC/stXAQCQgBcVsENIAAAUELAKNAAA/+a4DgFrwQIASMAEDABA9QJ2CAkAgB8FvFuFgM++CQCABLyogFWgAQCIF7AADADATwS8I2AAANpLwG7hAABgnQJ+fvE9AAA2Ru6LOO6pQJ8IGAAgAS8rYK8CBgBgpQJu8hDS+SvV/CnoujWNpfNzCWADHMsL+Lm5Sb10wzcu3fotfL683bheViDf8yVVNHEAsOIE/LQtAV/6YUjpMI63v9//Sl9/mdLb22Wt3/9twGMa/zfmdCknvctbus3c4fBt5t7ncEjDxc8oAALOJeA2KtDdeXh7+6qP/Y+8C+VrqFvdoG/W+36chzLCu61b/r4tAn4ycV+XMGucOABY4BGc9yKOrdzCcb7c5Psz937HLeFd1rUtfPlxyIcUPcSuG9LhtxN3WN3EAcDqE/BGrsHqUvpQv/8kzLSikuqQfho636IHkcaP5i4dxrc3P6wACHjhU8C1C3j4qch+meYOl3V84O4t/Sqphw3wfQf6zplL9oMBNCbgXWkBv9Q9gZf+fvuWqvL+9Ivvf2m+wzVofJeUHps4m8EAJODlBFx5BXoYx/FBAe/TIZX/0P3vhp2CIvijc7eqCj4ArFnAdwTgP6vWb3o0/n7LcsO59Mh/P76IEYwTJm4NaxcAWIRjaQFXfAipG6bp990kZU8GD+NHw8s8gMvUuTsIwQAk4EUEXHMFehjH/XQDHwp+8u5D+2WOwOc0zli7+LEFQMBb3gLuPji9+nGUKyeSO9Jn1lLvrKVLZJs2AOQjawm65UNIXRr3Mylm4GEsmjPnlO6VoQFIwAsJ+KXWiUv7+aRrobXDXZbLN3Wzly5asQAQ8GYr0PMlUs7Aw31jz7QN3KUF1i4MDKABAe+KCrjWCvSwiH8z77T+gn4s2ezULbN02TMwAAl4loArPYTUL+TfIh29w92OW2/pQC80AALe5CngLu331Rr4/sXD4bpe/zIwgPoFnK8Efc8WcJUC7vr9cqTo0aeSZd5hXHDmGBiABDxZwHXeQ9kvaJH9Plgj3QODXzwCD4vOXPLjC4CAJ/dgVTllaUmLLG+5xQLw4orrF545ERhAzRxLCrjOCvSyMS64n7d7aPDLXpfZD8tOXMajygBQdQJu9BTwwgE4OAI/uH296NCWnrjw8j0AEHBJ+sU1EriX+ejqYckIvHTlYPGEDgChHEsKuMZrOLoMGokLco/2jy2YzjP4VwQGIAFP7MGqMb8MGTRyWO/oF0vnXdpXPXMAUI+A76hAv1Q4Xzk8smDO/ICxmOGyBGARGEDNAt6VE3CNFeg+i0fSekf/tuZ5swsMQAKeJOAaDyGlPBoJisBDqbVBngK0CAyAgDfzJoZurFkjU0a/TMTMFYDtAgOoWMC7YgKu8RqOoWqNTNHgIuE8XwAOKx4AQEMJ+LnC6coW5EI00pcK5/0+H26EBkDAGxBwvkpqiEYm5dAFatAZA7A2LADVku0ijo+3gF/qm62hao1M28A+zA/nw5hTwFc/xQAk4IcEXOE9lJVvZfaFquNdTv+qQQMg4A0IuM9okoA+6FRIcH1eAatBA6iTXCXoj7eAP1co4Lo1MtGDczu0s+4AhzWwAUAtCbjJLeC6tzKnVoLnLg0yB+D9/pMfY2ADXN75/Pl//yTgjQk4715mdgFPboWaN7LsAdhdHMAWwuLl8+n0j6+en0+nz+cWPtSukIBtAUf3EvVltqe7MbuAzx5OQNPyfT2dnn9wSAMOLpaAK7wGK9WtkVQmYWYPwO6DBlrmcjmdTj+PcdUrOJOAP+7BOtU3VZmbeTNrZHopeN7SYMwvYAeRgIbDb2vv1Pv+0+0KCbi+BJy7mei61uEf5ozsPwECtgkMNJp+T381+Fr58gm4wjcx9HVrpC+zNAioQNsEBpq07+uH+q30rT65BdzgRdDdULdG+iJ7rP0YIeCrZxXQFl13Oe3u4rniE0l5LuJo8U0M2Y/TZNZIKrI06PcEDOBhXu/Ub51HavIm4Ba3gPN3E13XOvwZxfGICrS7sIDG4u9dxecGOrFKCbi+mcqf5bI2887p4Z6eMLsxRMDOIQHtcLmcdo9R7TZwoRJ0hTWDIb+Ac07KLBVOFvBAwAAee1Y9qt8btUbgPAm4xaJ9fpVk7cIaiggupgLtHBLQTPw9TfBvhU1FRQVcX8Ugoph6zTj+vkRxPKgC7RwS0Ih+L1P0W+fLfd4fkTsCvk9gY92V1FRCwH2QgLMW7wFEMVG/u92fEvADAq5vuRJxniZnF9ZYosQ77JWgAdxpo4dan5vYBc4i4BbvwRoq98jfBQYWVYHe7z27gNr1ezntZlBnI3SWEvRTgzvmlV+pOM+FEwcWJuDD1eMLqJvXv+b4t9LbOLIkYD1Yq9sEnrkbO21g/Z6AAdzDcZ5/K43AZQRc34Z5v2kBT3xV4kDAAO4T8Ez/1tmGdSwi4PpeBhwT5tJaxz9JcHFbwAQM1M7rTAFXeRS4SAKu8O0VMWHu03mlAp62MiBgAAuFwSb7oHMIuMWLKIOudMomkpkLiElt0AMBA7iX0wY3gY8EvKIwl08kJQSc9gQMICgC17gJXCQBa4KOTsBzX2Y8ScAjAQO4my+7zR1EKiLgl+qmqa9cwHNlOEXAHQEDeCACb28TOMdFHC2+izDqrQJrTcATvrKegAE8wMwadH3JLksCbnCeorYzs92FNcYbLuwaDgIGmuALAUvAGfxVXMBdAQEPBAzgAV431wadoQStB2t9d2HNLgc/brguBQr47NkFVE83swtLAm5TwH31Ai7QHTYSMIAFdUTAGxVwmEoyXUbZxQu4jxSwRxdAwPV94iMB38FQu0oKJOAuzr/7JAEDDfBla+eQMiTgBpcpBHxd8ZzlfIkFgMBASMDZBVzhhWGB/UTXLB9gtoDf1jxnBAw0wevWBHyMF3CF7yIM3M7M04U1xK8LIgX8yZMLkIAl4CZL0IFXSqxVwI8rbqx+0gBUJeAXAm7yJujqq6l9+LC6SAFfPbmABpjZBl3hFRO7aAF7GXCBI60pXMBDoIAPBAwQ8K6TgAl4jTKJF3DoMeCzJxfQAptLwIsL2E3QKyynDvEJOHLR4rkFELASdJMC7uoX8PwEfI7+PxIwsDm+SMCZBfxS3RwNoQLO0oU1hAt4rH3KABAwARcnsgk6U5xL0aMKrRo4hQQQcI0CXvwijgZPIaVYAZ/X+BEeTcCRAj5cPbcAApaA72iCrk/AY6yAc+gkvAtaEzSAh3kl4MwCrm+KggWco6AavgccKWBbwAABK0HfI+AKXwYcK+AsO5rhJej6b+8EUJmAXyTg9tYosT1YebqwWhbw4eqxBRAwATf5LqSBgB8fVOCk2QIGCLjStyHtggVc3xolRQs4w5+i8D3g6t+gDICAW0vAboIuUlJN7Qo4x3QBIGACXsMMBfdgZYl00QLu4gSsBxog4Hfq+7xLl6DbO4UU3YOVpat3tg8/PbYqiBPwQQ800AzHOf6tsL66dAJuT8BDuIAzbAKHvw0prGyQzh5agARMwAS8WgFHl6DDzk4LwIAEXK2Aj8ECru8Y8Bgv4Gv1Ag6bNQEYkIBrjXeLJ+D2TiHFCzhDF1b0OeAuyr9XjyyAgCuNd9ECrq9G0BcQ8PJl1ehzwL0CNAAC/oAjAX+grgICXv5kTWpSwAcFaICA662vhifg6qYovgcrx2WU4eeAQ/R78LwCCJiA726Cri6yJAKecA54iPCv+jNAwHULeEfAv+XvAgJevgsr+hxwv6xqxzR8JaXDmN63BG6/GC6eVgAB13wKKToBV7dEKdGDlaG3KLoEPSxo33SLut233/jt9q/p9t8GjyqAgAm47WPA/2Xv7HYbR3IojH6DMRrKA2SA1v0GLj+HYEj3HkHSvQ1Ir79OOp3udGyrfg5ZZIncmdk7yapS6qtzSJayAPjZAPwRZzOaLSwMwKUCGGtBF2fSH3LwF58E5u4DXmD6d+xtUbKw2EqcEgD8pPB5wQq4uEatTABGU2fSqYCtz8jCwgDsGd8NwKUpYLfkAfBFmgIOJCFo2Iy/FhYG4HLP4UAfxFGaSe/OBuB8Cri2QmcLCwNwwQDmVcD6DsvOA2B4HxJ3H/AichtiYWFRLoA1+mW8ALYUcKYyaO4+YIgCtoOuLCwMwAV/CwltQRfXhTRlAjA6+akyB2wNSBYWBuCiAexYAdxqG54lE4Brac+RAcAmgC0sthaNAdgU8O845wLwRRiAM/QBX2w1srAwAJdcgwU+iKO4kyhzARhNH419wAZgCwsDcOEAhirg0srUXDYAg/OfCi1oc6AtLLYWLgHAxxIf+J9NtwFP2QC8YB/EAGxhYVE0gHuVD7zjBLC20flfLv6i8aOwD9hqoC0sDMClA9gUMC1HZJwGrbAP2ABsYbE5AG/rW0hgAH8rTAHnSwE/1xfok+izoMEDYGFhYQAWF3sDsEgAg2uAFQK4t9XIwmJjsd9YETSvAv6ubHAO+fgLdmD19QFbDZaFhQG48CJoXgBrG6KcAMYCSF8fsAHYwsIAXDqA9wZgoQDukU+i0IK2xcjCwgBsChgGYCuCzlaEpA/Aiy1GFhYG4LJrsHgBrGyPkrMGC1yFpa8P2ABsYWEALh7AO0YLWtkQFQRgfX3ABmALi81F/NcIK50PDFXAhe1RDlkBDC2D1mdB2zkcFhabiyEawE8G4NIAPOXkL7YKSR+AL7YYWViYAi67DRhrQRe2R1kMwPn6gA3AFhZbi4SjoLsyn3jLAD7nBTDSL9DXB2wWtIXF5sIATAhgbUOUGcBIBJkFbWFhUbAC7nU+8d4AfC/y1mBhEWRFWBYWFuUCuCr0if8BdiFpA3Be/kIbcfT1AUsDsHP9eA2XeJXrRfptLKWvo8V0r5HxXgHx9sJsZLofzU3ACBiADcAfMWUGcC3pWdj7gC8y/jz6cZ7nZa6XpT6//7NMUx+x3F8vtPy8yvUKruRleRza12je/tuSEsiN77eq6O8VAp32Par3/++2yGE3fLwGnecfjNtaGzDUgi7sKOglN4B7Qc+yPQvaudFN07KcvzxL/YrQMYyh7vVKv6+wRDFch+IZ2k9/9VcsEj2qewUd071CFN/w16/69cu2BeHr5PzBFs+JcVurwWJVwLoA7HIDGCkC9QH439zTf9Wr5/p8rw7gyuW5D3iXlvMXiBeZ5XbtjT/8luZew8175aXc2N1cUKvXf9vuZTvx5UXwegkMwCkALqtOLe9BlNIAvKk+YNfPS72szf95+eHJ4Kv6vcXwJccfhHs3iH9atmC9OLS3l5Oqgz+qu3uvfAi+CvLHy+l1xAPVtFr8NlFbo/ijoI9aR2rHBmBlLn3uGiyoC2t9wAH0HefFc/N1Zej6EummO9uRenG8rBjfkpOfgNAB1/hxuIufqgOj5MG9dm0WbLnxpiL/+7d1Pkb0+NPI7q7/e50hGhC/lcn92o4N0Hqx8eZIeBA4/iRKrfY+owJWBuApO4CBZdDWB+w/70vt/yvP9frAPKA5rw093shNAgWje8gfrC4dG3Fn3vrg9+dexGMkPwvIqh3wFsLL37nqqkXN0b3ZWX9yAzAlgHWNkQAA4wbMirA8/xzmJfCn1ytOsnuopvkIfJO+76IM8p4NKysJkMCu5btXovl+e8BD6Pu+eFYtUNi/Fo83N+7SQN6F+2/CKoGjAaz0Y4RmQVMyJDnvepHzMJvoAx4Pvt7zZwTPfSR/weedPbA020f6DLC0j8MqgGBUHNe1JjOBPZ7+s9YcH8jSRxlkhEt8u0z7909LvIV7MBarmGy2B2CzoO9E9hospA1rfcBe5nPknD/QsavHqdUMD8qgGH2kS8ezZPEXxboWxos2RTz7xdrLkHiLfcq1owGs9GOErADWVSjuBAAYp47MgvbA7xI95ct8B6PT+iUXagKPHu5oIoH9CFQdOaxu9tXGtRHYuJ1698gjpyVq3UD9MgxJQnV7AN7zAbhVNTCTAADjqrCsD3iNUtOSNOG3bWivl4i2G2n0w0PSojv61h8BaOdr9rJ5kmMbh4yvNrTns7XRFeWjZ6Y6ISUxpMnraAAfX5QGowLWtUnJX4MlCsCF9wG7JXW/dSuZ63mWC+WjeicnO7o1BClLB8Z7+UENl7Yc4tkN3ipE75TW9NzalQ3AZkH/St4JAPCznO1E2X3A05Ludyxft0ueV63JCByizo5USwhSloYUO7GsyUM0Mr40JIVcKsKwGEKUekv2Kjyelc2dw4G0oL8VpYAFONDA06CtD/ih/IVUvNdTH5nFIDKhw5KTsXAMqkDqGHHHYEJHpX/vHBAWhvJAH9or95s8UT5bscctWJsrgkYq4G80u6pM4yICwPN2ATwz8hc1XZ8HKeC6JLuN0ORkR8/fxPMSAu1eclXkhl1iHGN8hPflNODLmGOwUK9iBq9NReVgACYEsCqX4CABwLiF2fqASe3nmwQOKOOrCdaP8DU36kcEUv6JcK3i7nt07S45ulj+eh2pleCTR7wNQ/IWLPooaK0fI4QexPGNcvO7yRQw7pPA1gd87/2fkQeufCLwmW54feRvEw0DSg2YIFXCGUW75R8B/P2gaIz2q/yKsYaIVyHmbQD0hw0bBHBjAN4AgM2CvvP6g52OP5IGQXuQ+iIADhFw3HNQPlojkpZ99s0OEl2C9PM4tsoNkb8z9G3wnZ9HHshpc23AnABWNS4AXQS4BMya5AOw6+drpD/7j/lL4Hdw6d1Hd5V7YBEBVgJHLrrBinHfcFA+yuumzgw6EH/fRj36Yqup2gSbPHD70gDE6onpt27SglaVJ0cU5gAWd5gw4ukDdv3y3+uHdBfI6C3153+u/07TKJy/Hxp4yjTTLwm1uRUHhCJ94UHWuozI//52oeOLuR5/zCqpSjtswR4Ql90igBsD8K1hAazMlzNOT+XPAXvM3ricqUvXlmUGfhOG5Hsb7wQOHQmY5e4ScpM9A4Ti0nVxmp7MmRxx/L2OyJiAyYfs2Sf9rpCtUsAjHNNVtO70pgGYJQVcXwDrO2pZ5rCgJ3r+vn39bxbN3/ehmkKHApZt2Dc0izlIlMYBONKjJVtzmp2c6KkAXNEMiAE45M91qwoYkb9FJIHVADjoO/aJKrjH8Jdqu3BlaQTcUWbHnmnJjT4EKqbYumUQcVn8Z1oApyWqA1bsATIn8alwtfzlVMCahgXCzgmkpiQ8z1ofcM/5+eRlRPCXsH27n84x2M6vzgJ+Q3QVcIQvHJ0jJfGg08/fQEZFMnBhW6UgD/3+nLidAdgUMA7AB4iYEpIDXrHsOfkL+YQfpWCPyz6gJHAKgY8MdwlfCPY7USuzKP4+nrKUfETA6DWYq27wHA6kBV3SIAHcyRnSS3wRsqF4LMWZ+fv69b/UASFNV9dn/B6HJQvccVAo1BdOMVIJdv1DowfAaclq361S2Lvw1MMBfNQLYMcHYEUKGFIE/XI4bwTAjpu/19/jkuZ3Oj+LixomgffkS24ShQKTwEmOL74/ZZTF35UZ46iDDtwgVXgAfzcAlwVgwPpczxCML0LphYzJAAAgAElEQVQAXBMb9rzZ8YNA/iJP32zIFWMKhQITs0mOb8W9YHLHymA6you/x2mXG8CaFfCOC8CaTgsDZW8ByzyoDJq0DzgLzuqErclhkchf4GlYLbHmSYRiz0c8OIBbWfxdlfj0o7eHbfJOWwQwmwLWZBOAGogmMQCmtKAzycn4bzWOMvkL/CbSnmw9h6RBQ54zteUH7LsNwvi7yh7yrRLwGxknIZNcJoA17VL+AyynIAD34gG8aBOMQvkLTALHG49+PlVDCw1cEhO97EgzoNcRSZ4EHmAXjW8D1gzgnQH466CAkrcAbVjPMgB8vw84Xz1T5NAsZ6EAxnnQ8ZzwMh1TZWDHSLyuaP6uzxc1gCOG5Ije16kGsClgGlN1BoEcA2DCPuB8ejLOHZjE8hfnQdMCOBlD/onZ9DOnkKUnTloC2GN/kTZZHcVmDK6A9X6M0ABMVYP1s6RVTBUWnQU9ZQRW1OZELn+BddDR2TQPMeFOOzYA79MlIlAd7XdbA/ATxZAc0YkTzQDeswFY0RejJkkA7kUD2OXkWZ1jJCjjR/5aoZ7w2sFQBFi+QADLM6B9putEulVqJAC4UwxgNgVcKVLAC4qbSzEKuBZp6IYrxkmyAAYehkWX9UNg6Ei+jyBw3gQa0D7bixPl9QfkjAzZp9gs6GIA/FMxIsqgIbYkWR9wXp4F2wO9aP6CJjuJXB0HFD0li9tJAvAgj7+779Q/u8cLYANwFgtakQLGnWAl5jRoKgv6cFYFLCfagH6W8E3CjgOKnkk7iOXbMa2UMlPAtADe7yQAWHMRtFnQRFTZCICnzMAKLMNazsIBvGQH8FPaeoEE8LATBGCJCWAv7ZdWOUYxJkf0fssAXBaAYTVYGC3dSwDw7T5glxtoYRnyUTp/UQefJeDiiQOKFSPyQIdRSjSg/U6qoiP8sBMBYMUfI0QexPGtGJ8AqFullEET9QEfshNtZt2GqOkEJgNwwwYOFPKqzANKCmByI78jGBMDMIkC/laMT4Cg5gWWc4SIIiILenrWBODDWT6AZ9A7TOQOD3zKDZVzhSzPEiugfa38pHE8ErwMR/AexwDsA+CnbQG4R7vZIgGcn2h1UfxFHXyWsOo+ZCNMBx6TFybe5VmkAe2Z36ZSwNEzhAZwpxrAbBa0mhwwIrFZA93sWQKAa6FIqxnHQFMVVkPCKxiH1hcD3KlTxRrQnq4iFYAH8K/e7zYJYC4FrCcHjCuCxgAYsSbT9AEfBBDL2x+YNAhgWBKYRAHjOnGOtNhA576ECuDqhRzATwSbEjSAjwbgsgAMVK0ImCOSwDQW9CSAWL7+gFMhgH8VD8hUwDgoHhmR15MvkgUDuMPPUIUGcK8ZwHsDMAFWPmppXMkAFsE0X8k4PRuAExUw8FsE3/kEMMChPMnkr+eTnUhukfDBrSP4d2rmrylgEqz8XkaF9CHR9AFLMHVrvlmVZamzA9gxQhHp+SY7lHuh/PV8sqSxbPFXvfeGneBv7Pqq0BqA5QWUmYh1H1CFRdIHfFAkGQ9K+IsqgyYAMJJDLOdtoRRwIxXAfktqSzF4CTN07w1ruAHsxja/fW0WNEUNVg11PgGiiMSCnvRIRhUtSA/6vSQAGMmhirHoKRXAg1T+ei6pA8VOaYDPPX8b8NAIyB+bAv4yItDCZUTt7SwUwIseyajFgIYdRokHMJRDFWPRU0e7QuaL7wwbiA4/KHeYzvw1YDe0Igq4DMAUum7G6uk+P4BrsVTz6dLSI4BRVVhwAGM5VDFqzqe0kRQrgH3JQwHgAT8fnF1IbhzaRkYFtZ0FTYEVcQAm6QM+q5GMegQwqgrrhAYwthKJ57wtBIDlCmBf8uzxAE4alGN2AL+rXxFUMgVMgZUL2eUEWdBODYAVCWAUgNEKGMyhh6sBWHOmAbgVy19f9UYA4GGnFsBX7ds2gqhkACbAyp824v/ZO7/dxm0uiD+DEUgPsAWi660g5TkEQbzXEpLvbcB8/S/Z5muTjR3zz8zhkUy1Ny2QUJSc+XHmHNKuADg3gPstGWClAAZD8Ts1QHvOmqmP+nuw0gA84h/KCF52+QJ4Xd/gOw26qFQiaIJb+pgZ7wTAV/YBH5UA2Eq8Ul01bXkAD3LwQBddkwA8H/QCuBUAsMWXI0bsJ9brO5Fbu65mmhRSqThgAlY+2sWjiMnj14D1cu1MX31sEMDgGvAi597gnjMFwJ1e/np3/+IBPDBe/UBZh7za3untqrRSqQAYjao/dsa8iJi8HBG0ksMd736F7rYMMGgf0gD1Vfgg1soVXesc65g9A3g5qALw+uValmX67xpUU6krAKb2YGFqyioBrMRYNmf23AuA8VtxBIuuCQDWbIC9d9B0aFqmvaEqrhZ6+xqmj9fh1ewOyauB4oALgKF7Qxn7gLV8vcGF31X3QACuBSrA36kBnvV1hqeoqAScgLbr76k76ALwVSijH2IB8IYA/JmXKk6DZuwD1gK2510ZYFAbNBTAhLMorFzXcTyAVRvgSmIWFX5VUkstvHyup+y8KRH05+tveGKMAEByY47bMYAv/EhDVaQuD+BBDsAEHY4GcK+5Aux/AiMYwD3nvhfdD7E4YKEL0jP16Tf+0hBLMgD8SwmxHL2pTldTGRfATyJGUObAy0QAqzbA/uatww4yc5g3636IBcAbaoJuyEjPAeAr+4A34YC3VgHOHkEbESjecsAMHxQN4Ek1gK0EgAmfBqsJwGN+AB8KgD8+DnxgjNgFkxxLMvYBa3HAf7ETDV2RujiAOzl8UFhfk6QxcwlYBMAjfomkqt9NAYCLA4bbuos+AO+5Bvy8qxYs0EkcQAAPcgCmsD4WwFMB8FdAJS+RKsGlVwHw5gDMoOWJ7fIevAb8TH6fj+WARxEoXlcDjgrXHGW8M8EDmSj+s4ICONkAV20BcImguT1Ylm2qMwC40dte3OzLAGd2wKNMK7CV64Sd4p5gys1M02TunMEkh44O+JrSOWk0NbwpgFJxwPgeLIv/nc5mntc2HfAWDTAGwLASHceaXFcDDrAMRRi/mZuxv2fXv33t+7YB/OU19az7LgAuAEY5pkYA6qUG7AfgHw8K4Gh8fPkzXeSUj7QVNA7A0Tczmf/m1q8sFxwgp0gAzzsDcH7idAXAaKg4hg076wOw/i7ofosJNODk7xT/JlObu6YGrDKgEX2A0x8zW6fc6FhwowBe0Q0Az1kAXOcnTnHAn54Go17b7wHAivcBu30ZYMhh0PEOWMaVEs4YxgI4dt7my8TWZbsAruGfhlsYyANgUwC8vyboL6ykUF28Bsypl/+grk3cj4d1wChhF0xQB00qG3kz0zVnvwxZJ5VAzSe4AdbVBK0AwCWC5qfFJ6rNyxZBa8HbM7WgsE0H3IEEknVC7xU16DWpbI/jb0vZUSwDYAPPKGpVAB7zI6c4YH6/lMuvygwAv2h3wMcf27wUAXiQA/CiSWVn1KxYc6PP5RqAB9rCIc+pYxqYVACMtkyNENZlAXzt+4CVGMzLrlqwMF+H1GEEktabWgl6IItXxVBb2i8Z0TGhcImgpC4Aa2g7OhQAY6u1jmMV04rAjH3ASjbZNs/MesJjA3iWkz7e19FFCE/czUwcCqaiY0BhfuEtHLrHBXBxwPR2KcjxWmkAZkTQSr5o6CavtppA6wEwz5fUgkXACOEZkHBhzM9kADBiCpVYRr+RHqwCYLhnugi1duUHsO6m4a0m0HkBbGVk0chZoAibsxDkfIUS+EkEwAf4K9IF4FEDgEsEDbaqZw4KmrwAvrIPWEmT8S0AbzWB1gNgoiutgZTAA3hgjLMgp2hFAFzBX5HBLxJks5HigLfXBA1qg7ZZZ+ZazrR4K5OtGmAIgH8iPE8n5z2ITTgVXBMj7dSybQB3jPeeFcBVAbCyEjDLqR6zyzIjglayD6khdrQ/HIA//ZUOcgCeiTork0Df1zdgoFDJALiGt5HZAuA/s6oCYGxXEQvAP/QBWEeXk9tZAg0B8AzQJGZn6pNYC1ZQuZRpgJGzDDrDOH5Ug775WxDIcw6HUQGdAmCsZl/jwd+nzQO4Ucu4y756oPMCuBZypVauByc4gl5oo3QbBvDCvO8824DHAuD99WBd5QGpu1q0BmxJiQFrYeIeGcDRjsIIuZJRzgAF+5yBJub9nGFOPeYtDUzk5WmCVgGdEkGDAXymZdspD5ASQauA3I3H8vLjoR3wkK6Qi5z5oB7DYCQWL57qhlppBM0JklN0h90BuFYBneKAwc3KZ1ZDUNOqA7AGyjm7swQ6qwN+knGlf4gBtQIYWgNemERcGI/v+2uFWMSFet9zAXABMAiTlpaHnnMC+No+YBVFYMfrp3tAAI8yrhR/xBKs0hd3M5b9YuLL2gviLZHvOwuAjQ4AHwqA+QCG+LGUIjBlH7AKzJ131gMNAXCXDuBZDsDcADIQwF36fChvJhrAHeItLVzk5QCwEiAVB8xvglYAYE4ErSDobXaXQEMccLIocV1pJWeAQwE8k8eYmCADO2B0kcCQS+O8VUwBsMB15PUqE9meF8DZjWbDCzMeGsBcV1qLtWCFnjcY14IlUR2QB7CRSqCzANgoAXCJoOlN0MQjPsQA3Cgtte4vgYZE0MkSOcgBmDtUoO5E4WoKGQFggUcZAI/o3jH0elEyGSkOeBMlYCqAE57gkeOAs29E2t8mpKwArmUM8KfOZLL6BuoOtQULZfeCxpvTEQVyqAZfpt58CbgAGAzJc0sDVcpXApMi6OxWs2lVrgs2D2ByJhh+xNI0iQgtcxMwbHFTSQMYBEirCcC1Eux0BcASLjX3PiQWgHNn0BelyXhmAC+JYPTjUGWWIR3Ag9dIa+yaoOI/uMBqYrKfDJPSIR3AmOVYpQrAoxbsFAAjY8uG+ctdRgA/n4mt4+jHveUeaBUAXvz4Gy2dJvBWTbxK13w2WqG3Ewf8IRmYoAS65mUCm+2BLgAGM/KSg+4iNWBq5Rz8uF8eHcCxsaMNUNzff9BdnDYH3qqx8Sr9RI/uw7U8EWgjf03xSbFBfBxZz2PDPdAlgpYCcOYuLFYEnRd2tx7I6dEBnBjXdt4SFifvH7TAh+CTTSAJv2M4XMu7bQAYnECPxLY0empRHDD9QUD6pP7K0eGVFcB9xoYnR3zYjwjgQ4grTRkpCHnvyh0p04YNqwhhSySOEIBrbIW2ahUBuGoLgLVdXEQS9ziJAPh2/P33SZsBPhYAJ0mujyD+/895SJM/n6FM0qRCaNVJaXkS08KUNH6oGptA314JZdgGPOoB8KEAmN8Enf0wyiPNAWe0wGfWauPBI+jlQKZiFYKHf4WDL7UzFiykKnAlxHqD9adWEYArRdwpDhhIyIb76+PboHkRdL5G6Ju3RLufpmlOpw0AOFYz/WPlf/+aEwE8BwAutdyspAc62VXWsgCmJ9AZdiGNBcD7BPBtQkJiUZ0AzhT53uQUZUHQNM690vf1cu7UaAdwkuR2IQo2JEi7F/JST8ekJ9BxupZgK40sgEEGeOKsRg6C76xE0MzLcQGcuQ2atg84Xwh9M49n9GW/4vfyPuB6cb/cPgE8evdFtRgAdyFmZQAbr4wJdBJ0pABsoQn0qAjARhF3igNG5pYXbok5vguLtw84E4Ebx11KfZ68O/YfR7DOOc0AXlMk10dxE6k4Bhjg/2SDXe0TTKCTuBY24hw7zPuTB9HxO/mfhfmrCkUFwEJtymTA54ygX02nOIG/uZ8THL+XazM+6QVwlyJMHj88JUapNsYAR245VtgD/fuaZPDRxwMYmkDXpI60KAOsCUVdAbBMRJzXAZMBLF4GFuwJaxp7bTBLI3A6gJcUaR/4VLTe9/lBNegAlkygE6LhMOQnOG1oh7LRA2BdJCoOGFg4bNg15iYbgO+NLOqBG3cmd9N99L/2Vu5+2iOAw2LhtKMrhhDd7g5cQMahKr6fdhABcDzdaqkEWhrApi0A1ncdyb6Mvc2JXgO+9/qOTswEu2+b0bArAXcRt/3pAJ4TJHcJgk6fosZBBjgSBYa7aknYUNqJ8CPeAZu0H/dPoFtZ/la6wFMiaKBsO7rFtrmmdxfAPEcYeC/Qu2hW+qpND4BHPztSJddNre9tmlYOwLOwmi8yAE4zihIJ9CrLX2UcKg74nR7sEm3eNmgBAL/1Bgsg2LmVX8z/d7CzwLJNDYCf/BR3TAXwk7c5G5MnZVFCiE6gowE8CgF4lEqgZc/hmNoCYI3XqQA4eh/whxi64TK4ce7eSgDpSt29rnNK5TsdwJG5oQ2OhePE03gn0K0cgDvur8dlw1YQwCIJtOg2YHUYKgdxAAPiM90txe5D4u4D/hAnMXfIOucuMm/y/X3eH41RBs4G4NFLcU0ytsYYA8w+CGsRlvNYtgUOmXYOB8qcjoS8Zh/8LQ5YrEJLrzLnjqD/+TzZ49vlAO7zy+XW/v74QCJ6zJlxBEkygCO1/e0vtAuUsBQABxZYB6rgiifQnQxCliRUzRLYEwRwZdoC4P32YDX8bDS2C0sMwLDnGUkhYAnY+dwC4buHswHYSwynFgTg+2gw6ZPyVp04HmYoAdetHIBFEmjJXUiTPvKUCFoKwC85xZm+Dxj+PCPDdmAC7XUH/YtCAMfvzxgCifYzHluBQ3VD7Jx2lUCHAnhOATAqgTaUJ7EL/hYHDOzBcgLeLFKcj8IO+JgLwLgeLCf50YECuIuW9i5U/+dobIUOFTepJ2rZPGVLKaWcCrSXNc6bfi/9cgA2tgBY6YUJEi8CAI7k0sNE0E4cg24vADY+PB1RAF4Ch+IehNVTfzsyGpYC8IhDo2HkNeEfu0klgboC4BbUzHpHOPuTpC/bPIAvGVdSYQ/6tBsA31fcCuBeKr+f/EMwuA44jod2xwB+wu0PWindaNvvvyoOGNwgdc4ec/OA+HwWBnAkhU7iFIRXgXMB2Hr8oAHoe+V3j0ayS4rb4QUEY+CY8SZ2FEqghQA8rbYA+KF7sFDlSZtnheGkVzQu30oqcPiXkzIA/4wFcKgrjdP32iu7/nOomQlg+jctwcAYOGbKORwyCbTIORxK4+cSQUN9090vDMqozo9SA0YVZIO2ezllAJ4jpb0P1tJoAAeH3ZF2zBPA4puQhL6MMGEcK3IMpQiAX/GrFz7FAYuVZzGF5suDAPiSbyUV6r/Bx2GlAriPBLC9L4UrwmCZiBYs8jbgRRrAcyxMBLcBoxJo1qPwpa9ZV8XerwC4lWpQztmFtb19wOecAA5jYK8MwEOkUAa70ngAhw/FBDD5kA9kaTawlSjBaUt8EVLSo6iqYZiqr/+8/ft+DdM0mVb1VQ7iQIXD95EhEnSzasBWdrw4B4wqxzrp5YYCAJv7PzdC9N343KKRZGQcpupWP4DneACjEmhWO9rBmFdvu6792tv2/Z/+7b9e/9/y+1pX27far+KAHwLAD1IDRgH4nOPzkxnAYxeupVHksj4/ZyHdRJ6MXCRYCDGmoTufEqJumRashHa0m4/ijbqv6N0AfQuAgQ7mft+OKwD2v/7H3tnluI0kQfgMgkEdwAbczx6B1DkIQnynCbbeuwHx+jtY7GJnvGOJzIqMTGYlD9DFLpbiq8ifqm8mRl82x9gYdDGAhWWvL5XwBgPw7nJrXQCrFnhhC49YAB5REehZZ7W6v982Q9A75oBExrudPB+vD/hhtpMSjL0GAPC7QEslAG62uJ4Bg6xtAKangOXusmENNLIi0NUDOB0wrTrqahEeReWA2Vb0YbaTElSaX48P4OYm0NJFJsntfnHVjBK3FBYioLO7DVgM4KHHAPhlmEAM+vMlARwEwFeSbbra2LN6csCgUPD+Ox+hMehSAAsTjL2AZjcZQ/r94qoJ4IkNAHkKeGQB+B3D39eqXzuA2wQwKHP4SZJp0ZXAdfQBg4yoAICeACyTtEaipb0IwK8NYMdM00qrxuVfSJyZ3UsdeRcSKAI96s3FGAPA6YBRxVEbAAwZaDX5Fw/RB2wH4PvhAdxLtF8G4EXAesU0rfjobH4KeG/hl9xqgyLQcwI4AewGwLyBFHLAMxlIqxmAJSGG9ePoABZpfy8STkmwWwZgzYjBrKa5DgDcYHD9RXEzMsQAcIagUf25MwnAIm9YRw74za7KzRGAexX+NqihNhz4MYOY1SjOl0kKeK/tFo+0Z06a2+39dutlkFRoA04HfLAJA6VmaQ7tUQWAH2YUFPFvjQ7gEQZgwYEfmgDugPOhnQLeK6KEm4aa8d83HXTdTTT/8mhAAjgKgO+kLqTL5Q/aSHA+HOE+YMMiN2QS2CeAZxS7Xje4jChKNoqQGtQkFyiiNwZ//zPW+02ySWHdy+gXwKfqAczzpVea18bngNk8Ejhgu+mFdgK7BHADM4/vvYAysljqly3TNVFQiIlAn13sxf46DX/Zh/yfB94yR6x7GdMB+wUwrzSqMyNEFTlgTChDdg8iBv4QANNKsGTqKTnwQ7MNuI8L4E4bwH+fhV+HGy8J4ATw6+cnTzXNYqRVnAVteNQn8iiOQgCrqO4//3pFWJREoIU6vYUAHQWFIFs68obaFn/+ZT38fbx3TQCPUQBcfQiamTk0qxI6Xh+wwIgaRqCRVViFAG41pPYMG0p04IcwTjzoTddoskEasOJe+tye5pxvW17xR/UArt4BMzOHmFIdAZuquA/YrMQNmwT2COB/Vn6VGp8Rl6jdsmYntv63pygAbp7TZNPLTgng6gH8lafbf1iZtCpywIYpYEcA1mg9+c2Pd2KxXuga53L9w6vZAv8M3L3Y/97m/ek/t+llO/ESmoMAuK0ewExXek0A64EQM7lS+uGqsBwC+HahAfgfdULvwsAWZf4oeVkHS+H5ovjLh9pkgOXx+CD8TQdMPZ7KrFO1hj7gq9HcQvP75QDWoOKMZ8mu0KIegBc2gEtSwI0nADfPh2x0ZyPKQVgJYO75kB9GCn28PuDVBsBrAnj7b7dnsb5VE+keuE1QDws39kvhtxXQv0ZUt6Wru1PtAK4+BN0xmdhZnQZdQw4Ykkt4iBfS6gTAPcmV6jQ8NUBqbWgVkv4Lg/jzlLhST+dwjM+hv1HuE8DVO2DuDTpWZdA15IAhBPxmXEtQDGANKs68oUYggEc9HM4mn8dRG3Dz/tzhb3xVcTzgS+aAgwAYo5tvVNzvj5NWcB8wJLpQAD9YFZY7B9yg7ctua6l2EmXL9l/dKQaAx+dA2TpB1Z/DkQdxrFRPanVjbQ19wB8mMwvOZRQDuO1pYqvQ5fIblViAMEcgSl6DVTRnOxen4kmUT9R82cPHBbtRSwd8PABjZHNryZBVH1IFOWDI1L4V/JJ8hKBbntgqAHh4mliEi7QUUXL/1TMBrGeAn0zt+54NSgI4AUzVTJBN+owP4N3J2OtXWwBfPqICmDjUgMTWoDZZgwmA/ZzD0bz4F0f16YgD4MpD0B0XwOSIN25Yeh/wwwTAj4KVtAYF8GjP+l6JV3QAF5lSPwAenkN1+4smgGt3wKCY8MwF8O4m2QruA0ZU070VABhWBu0NwL9d2xON9VoA7jkkBIRcXQG4eTHsdjr2J/YXSAD7erhF0Pzx6skBr9bsu7oA8A9evc3EYn2ngImSFLC8BqsoBby3DXjSAvBzwHa3SwJ4+y4pAUwF4jUB7DXKHgPAE8uVKhTZYvudNgD4RAZw2ZSNTgD84t/v3rfPx4n9BdIBO3u4RdCwkPcnm07++4CNi6CdABhOxSe/257lrBYlw7iQSAgKCg/GSwGff31nBQMSwLEBvN2ugYq+9vrD4/UBrxZfci0C8EdIADtgvRaAezaAlwgABrrPJQFceQgaJJqfbOLTHbD7HHBnDuAuJIAHfPxwt7IvSpiUzpVYyvoIAB4dADjMQVi1O2D+yVQYlX4LD+C9Hh+ylXoULSYXAOZFoOEAHrDJzFFrrhqbj+OkCBop5Ang2gHML0rG9CF9n8kAdn8f8P3DILCg8WmdAZgn8L9XiF7HMC5sBC0RAIxk35QArvwgDlBb7kxH/kzeaLjvA74mgDUAPBIBDI7czlryL3bAfQAAQ3VcDOBLHADX7YD5GdmriUjHzwGbdyHBTuIoeouFJ7cLjfW9DibZNViFSdmz7VL47z+P1PHewy4gAWz437OLoK1Og45/FvTVIK7wy/MzIIA9sF4ILjUeDsJvU2hJXQC4GYjwqcIBVx2C5hdBHxXA9D7gvSFo8zZgWCOwJwAPagHVPQDWCRS3JzKAFy6AVYqgoSdgiAHcBAJw1Q4YUrmzTzFBZ/bvZEX8+4DNu5Bg27kiAPckKOIFfgCTstHioVjJCids9ABgaPVTHoRVPYANKqJWgzHj54AhgYVH4WqKB2AXrG91DCM7Admdjg9gLPlaF9sA26etGsAWTbn3BHA64IMAeHTB+lZFpMXxzzMbN7LId6fAXzD5EsC1O2ALAJuUQYfvA3bQhYRK7zsC8KwBsN2a+kMHwCcygKfCHcpsD+Bm8AHgIQGcAJaatavFoMfrA175AH777mM/96n3cwYGHLEC/0weJhWRXsjqX/ppGhbdFPYe0J3VqeAs0AxB+0oBW7AQ5JP2ASp8DhgC4M/jA5gXcMTWWzdwcr1asBMZwO8nLoA1upDAGj4lgOt2wCbRYFSgMnPA6E8ZAMALT28XFuuVAMyuwVqOD+CGy54EcHgHbFEPdTkkgL3fB+zgHA4PAIbGHZvZBetlOv1Kb9iHQBQnB/bSb8IDGJ16Ze+BXAL4VC+AbVpyUdj/pI7pvQ/YBYDvsRzwyBP4Z+rQqYh0S7aBxQD+QqIbT8K7BHDlDvjDBMAWge/4OWD7g7BgLd4FAJ5IrhQ91HhhA3ghA7jV3Q4xAIxu/ulOCeCqAQyqR97bPQoq/foeG8DfDNjnJKXhBMANkfUDHF1nrZkajb7MiBV2BxFoeiNYhqCdARiil7uPjLCovT5eH/CDD+A3HwuqBMA9z/D0LNarAFjOJxmAy3k4WAO4uXgB8BAJwBU7YND1cbv1EhT5npn/qvP7gCHp/AaY9lsAACAASURBVDUBvF3mOhrrFw2R7sg+sLw6bmYPqB2BznM4agfwemwAZw4Y/C2LAWwegkZS8cUPtqOxftIQ6ZYFwtKUsxsA4wV8SQDXfRCHgRO1An/0PmBIc3UxgDtzAAMF98YT+EbB1Q9K4i/UsZ7NPziAb5cEcDpg6L9uUwRtEvoO3weM+JaP0hVlHoJuWa4UO9SND+CeC+CObkDh53DgqTdx90AJYGePURG0SfHX8fqA901rlwAGU1Gtj3a3tvcary8HsFEEeq9+TmD+Kuh3tgHXHYIGAfhhBeA9iIqeA4Z8y8/SFdUFAvDZC+tVDsKSO9KRyhq5fvbuDbAcwIH4W7MDtiqCtoh9R88BX796cMCYD1sAYGDcceQNdVZgZaP19l80VBbf+4ruQtKQ7wRw3QD+MAMw6MSkmQhE5/cBd1/TAf/53HCC+8rxTCzWL74ALHKCLd2BwgHMRw9qL+IcwKcEMF0u+WXQ0fuAIQ549rGkCgDc0wQXKPAvlEHlHI6JC+CJD2DvTcB/PqcEcDpggy4k2JnBD+KIznPAdxcO+BoHwCMRwBpm9aw1UbOCyPoHsIZ6v3vaDCSA6Q+oBktyfiG/Civ6WdD3dMBYAM88AI8a7nFUenuRjCEK1gb+kMqmc0kAVx2CNqhFBg/9RgQivQ+YH4Iuvo3QvgiL53iADmvmA7jlWsGFD2BwG/CgIMCt1uYwHfAhAAwqgn6YCfUeYkS/D9hJDni1BXDHcqXIoZpDAVhkBXvCjkgVwCrivSSAawYwqBT56/rY/3zQ67+i54BdXIYEWlNyALc8x0MbShgtnhWgLgVwZwBgbBG0StBX+hFCdSFd2moBDOpC+ir4O2+goSMDeJ8DvpuCz0sIeuE5nuXIAC4g4mj0WWwBPLgCcDrgCAC+ogBs+BAB7LwP2IcDtg5Bw6h49sN64UFYWngaiaQpsX1QAOt4zj4dcNUAPj5/d7jE4/UBr+TxEEVYmLoCOYAnlOKOvKF0jrxstBLYI15iVajjPwKdAK47BB0BwNvjwpkDriEH3JNcKdJhDQYA5hZBL4x9Cm6Lwap6Eu9LQnUh1euA1wAAfrvEBfC+HDAin7A6WVRVAfilndEAcAESL8cAMLQIukkAJ4DhT4AU8A6bGP0+YMTXBISggwB4vBwdwKPSyzdWX2UndaDncOgQT2zSh1gAPtUJ4K4uAEfvA/5JDejrLioxgGGnUw28oV6K+3R0ALcWEJyQANZR7jYBXLMDvoYA8GZKRc8BQxxw+aqyLcJCJf42/FQ7lrh3k4JIUwG8HB3ASkVPeRBW1QC+hwDwGhfA3/g54KOHoFFxxy+8oV4fednjAcwtgsbECgaLQVVzrgngqkPQEYqgd5i24/UBP44I4HsIAG9Q3IU2lAKAFyaMQLGC2QzAzeALwE0wAFfqgD9iAHhmkcH5fcDpgHEA3vJLRQF4KNUnCa8WmhHFzdQMVXUPbbdTArhiAHdBAPzJIkPmgP074ImnuD9YrO8U/u5EM6IwL7qTgsg24NEbgEPx99ImgI8M4EdYAB/SAf+MAOCRN9T5YgDgEnu4e4mgUGiTjFBMuYq/wjkWgCt1wDGKoLdjKvuAKQdxXC0BjIo7bvmh9izWK5zDUTBP+0UMlRYwA7Ca4ZR+hS8J4AgAjsHfzVw8Xh/wygdw+Qq9BwBwwwPwhqEWvEtqT0QA90cH8GgEnkragGsNQYcB8MZZDZ4D7tIBw6KdI5H1l+gA7mwADGwD1pLtPAirZgfcrVEA/BkVwIc8C/oeAMCDK9YrdCEVAHh3+HMx8aHAImi1CHQCuGoAB0kBbzaK0e8DdlIFbeqAMXHHTb/TluauDt4GPJkAGNgGPCaAlVF0qjIEXRuAsw84fgj6cABuTABcYg/3ij/vyGwtB6ym2nkOR80OOEoKeDOnMgccvwiLeOgw74KBHo4NJoBhxVD7Bsa1Aes13bbu3igBzHvuYQC8sQor+FnQCWAYgAdXQ8lo+bwN+MQD8HJ0AOvdvbskgCsOQa9xAPzJ+YfpfcD8EPT3z+J1ZRqChsQdt/1MJ9ZQHV6kiQDGhYIHG+4rJlwTwDU74I/aABz9PuDMAYMAfPY11IIX6UV7d6IQgd6ZioUBWFG0+wRwArieKqzMAccPQUOoOCJEAzdUe2gAL0YAvqGGVTz2sddcoAd62hoBfE0Ax+oDTgCjqDjzWD+rIaxRevfGYkskEE+jyDflHW/pgBPAnp6VA8TsA/YegoZU3jTOhprwLokHYGAxsg2ANcO9vb89QQKY9cQpgt6KjeP1AedZ0KSqFkGAr6MN5QvAZ4MvkgCODeAqQ9BrJADPlP/4X+zdQY7jOg4G4DMEBfsA1YusG4aVcxhGee9nuLJPAPv6M5jNvHk9lUgi+UsiGfS2S7bj8DNJSfb3AcNurJIAz5UNNbEDHHAAT4UALrT9B6Y6sCkD2GIGrGcjymipfC9oSAZcsgS94gL9jhoqk5JXto8wkPgq0ImpKNvk661CgAcHuHmANbWAI8O1vw8YkgH/1TjAkSneF2yoiR0OHMCM7wRMS733IuwPkIujbSdKkxtx3DQlwHGpoq8D5irmV9sD5qg7Ljjr47a8nNizpB0G8NQ6wEuNAHsG7AA3OAvLe8CIDDicjQO8wYaKCwcj/99eUSIxVqAvH/BaiPR8JwfYMMB3XQBvKgH+1WIJuiDAAaYiD8BDgwAXyUPTKWQCWNQ634nScAn61AXwE3HK8HXALZagQ8ESNEfC1eOsXwoBTDn2tBA2FcuAmUbuJWPw7wrL4p4Bgz6qJkHHFWv9fcARH/odWjAD5pjyExndRhjA/BthkQBGVyTyMmCukSUr0NlZugPcPsDBIMDeAxbrvbI/B5QDeIMNJbreaRYqFCQBzFmBLgKwbLF3rfGpoMRntAfwzQH2dcAyJei2M+CuuqHyKPmQOvYCjdgMdpiWP8kCPDnAZjNgXXOw4qrDvg4YkQGXBJgh41pwEX6RDNOz0LH3jHG1foCXkuw4wIoBPpUBHJO5tbcOOK3pzLIDxtAywBMuzP9GDVXZRlgd9nkoN3YyAbw5wF6CFvk8tAHsPWCehyp6D7gcwAwZV/QvdEUNJQAwah+OqRzAe4ExUberuo2wDGbA2uZgRbVLtfeAWeTb6ri1igGMGyp2vRN/q3bCAMxbgU7LRnmGlp1unDsXrvMSdPMA39QB/AQAVfn7gD0DBobcCTVUYM+SSDAmBH/WCnSR9U+y0vlGWLH3uAOsYhaW9nXALPId5Hvr0TLAsT9Q+jLg2FggsBEWCOCpHMA8YwuHawfYcAaszd+YJrD2HvC9CoALlqBHXJQPsKFG/r+OSQpDSYBZhuyHKgHuHeDmAT71AbwpBPgXHuBnwwDTa579BrP+S/SkeqmHhw34bRBK0A20gB1guyXooBDgpzyI8HXAaenozXoGvONCLh3g2FRy5Q/SGIDXggDzrEISjta7A2w1A9bXAo5J3bS/D5gF4Gsd91YWwBMu5JKtjw4FeSf1IXTs8RGMuQJdYA9M6V7rKv2U6ABXC7A+fyOw8h4w/0SzqjJg2MQohgjfy57UUhxg5gp0Wt7HMvjiAIM+ozWAg0KArwoBPvDfKj0D/mwX4B431KIdYOYEOI0dlsFn4Sg8OcBWM+C7QoDf66h9HXAdJehQDGB60XPGRfhZdqRZ6NijIxh3BTp60hobwNLB2neitAvwqTEDfoo/dsDXAZ94+hrOgAMw5E6oofj34aABXKoCncYOB8Dic51yD1Kdv/ZK0ArnYEWki9p7wCzdVzLA92IA0ydGxY8Fi+6V7cPRIwnMLryypN9zpQDr2wraXAYcHGDvATvAhJwnwDgZ+bMkBMDhUhJgllVI4gBfPAM2CvBNJcCHOIiVvw+Y54XA1Fu0XAl6xcV4qvXxgYB/IyzIVtDsFegkDzkAlt/wsdoDwwN8sQXwXSXAb3nUvg6Yp7DxtAvwhgN4KAgwgkH2CnTSrhgcAPel1bEEsLEMWOMk6AiAtfeAhyvHVaRuhXUWA3jC5TxUgL+Enyo6KZ1mWVyYAP7dwCpgB9guwA+dAG/qAP5V4MHq2SrA5Jk3CSGXmmzPwiMtUgB/lKpAJwG8gsfL+uwOsNESdFAK8CFNA3wd8FHAPupWWI9mAU7oMk6o6J55UmIAb5jrQwORYxK0PHP+NkKrGbDOOVjvudL+PmAegKkZ8F+lAKY2/lJ+nBNsqIn9WQJQgh4vzQM8i4fh3Ax4cYBbB1inv299VN8DruJ1SI9mAcZF+EV6pFmoQdrNorYw5X0OcGOf0QG2MAtL+zrgOvaibBbgBRfh46N74E8XKQ3SuADGvg1lYugcscNlflYH2GYGHBxgpeuAeQCm3aOhGMA7DuARFt0rA/iCApCUAY/Y4RxgBzgpTJ9aAX5K94DTvj70XtBVAHwrBvDaTITvpEd6FWdI6WlcAFvbBxigXO73MOsD2FgJWukcrLcJo/4e8KMMfVUATK17AiP8UhJg+XcxSFSgk74ehhb0XC/Amz6AjWXAnw6w0h7wA3AV36X9rQIM3Gt4k7ZELgMG+UcDeIKO5gA7wODKaKPToLW/D7iKvSiZHu/wAKfkPLQaaycOcD+UBHhygB3gtN/uxTNgFQBvwj1g9JNO6pIgFoCPGh7vMgDGTXslWi9vySJ1nTrAk1ANAANawNmXaVAIsKkM+FQL8NV4D5gH4LOGuysd4LEZgGdxS+aSAItUoJPejUAfbasXYIWvAzYGsNo5WO/AUr8XtGmAd1zOUz3AH1IPKp34xWH4fuhvgugcYC9Bi52sYoAPWRvg64BTq8Es9d9rDXcXHOB5QEX4pCDAnwGPwnloEPH35TMFewreA+LweHGATWbAd8UAn8I94A3MYSrALOknbSFwMYAnnIojipLcaqoYwAuCP2oGTD+C2QF2gKU+N8UAX433gG9l7BO4u+AA49rNScXu9gCWqUCnmLg6wI19RlMZ8KcDrHQdME9143oYBDhp2istxdrER3oZZkgH/1UqAU6pG5AfASBh2t9GaDQDfmgGeBMFsfZ1wEz8UWZhca1xqxpgUooFyLXlAF5krw1PUkoGGNECzga4d4CbBljzHKw3KWN764DPIgBfWwR4nHA5zwQDeOcfQhZgoTnQSS+QIh8C5HUHud/Dh0KALZWgb3YB1t8DHgwDjGsB0wAG5NpduYOXqkBDAYZE6bHmpwPPgOUA1uzva7H094CLAxzONgFecABv8gD3Ygc/i14aHoDJ70LCROnVM2AH2NYsLPXvA+Zah/TMv70epQDeQeF9gLzQj+ZZL9akfXedwkUDwEPNAM8aAb7YAfjUDfAm2gNO+/rw64CZprjnT4MOxQBecTmP9FYWZICXYun7rgHgxQH2DNgB5o/bBnrAPPWN/Az4Vgxg4BysHQNJiwBPFQD8u4kWcHCATQKsexL0azv07wXNBHD+Xlj3UgDTZt6kBTUcwKExgOUS4Pjrli0bNkhn37Aqe8B2StA3B7ihdcBHawCzzTCoGeAVFt0z11bNpQBeawCYmoWDFtpOngFbzIB1z8F6PU9K//uAuQoc2TXoRymAR2DOs8Ki+8jPJM0nWhztJjH6GQGeqzDHAdYJ8Kkc4FdVYgM94OFadhZWowDj2s0L4Kw6uTYt7XC/IABfHODWPqMDbGEatIF1wEzrcHM3owxtAtxjQud7wZjOSgzgjvZksiCKFFSAQTHaAbaZAStvAb9MGg2sA2Zah5S7FcetGMDCOxxzAZwYACQy4ItYBvzuO+i+CRduhtwJsFXA+c8JDrADXPPnkOwBb2AM0zNRpllYmTVovhkGqQALFlY5k+3E6L7yDxLkcHpHXx8QTy5UgBcH2EvQYp+beoBP2z3gm/hjjHz+jQa4wwG8KAb4bWVgHhEAfzXRAnaAbWbAd+3+vqqeGugBcz1h5dWgw9kkwF84gDfWuJSjPA3gjVKB3iBXjjgJGhWiHWCTAN8c4JbWAadnwEzToK7PrLvrUQxgYM6z46J7dQBTDrYbIBkwFWBU1dUBjr8p9QB86gd4E+wBo8sNGZVgJgOfhR/vEgEmsZL4oyQsA07c4yEzA56LADy+fy5oAeDFAfYMWO5EH/oBfpruAXMBfLYFMGXmDSYtzQmeQWCUbymA9/f/F1E7oK5Cmh1gB1iuAq0f4E9NAP8q1uXPagI/mgQYk5bWArDUlmFvLwsRYMSdkFEOcYC9BO0t4MiybXvrgI9yz1gZyXcoB/CKy3kIAKf+/AV2ohTbMuwtfAvpW4q+dMSXEXYOsGfAcp+7AYCvgj3gDXy1CwJ8lhs6A+AJl/MEQBpHCtJdEYCniKOaADASM+AeFYp3B9gBNjYLy0QPmKsOnPFGJM4ZfjiAU1UkALxAgvTrILPLADzG/FfEt7TSAJ4d4AKf0QrApwWAn3oAPsp9x9dk/Fln+KUNH4AA720DTJqEdcl3bwEBTJwEPTjAngHLnaeBOVgv0kYL64D5HrKSa9C3NgFeYAAn//qn2jLgS/YX8J+DInxLPeBOgAZoB9hiCdoEwIdcDxhd8M9ZDHT7LJQCs/Y30kbHbU5FqXEm7/EwCVg1igC8R517AwDDQvHqANsrQd9NAHza7gHfxB9kfvhcmwQYlJbm5NoiANMy4C33SBcQwMRJ0AssFn85wPYyYAtzsF5Mg7bRA2brMyQuumKtQAMBHmAAz5ihXg8j0gPe4x5z6gf4GxaLJwfYHsCnDYA3qdNv4H3AnG9EOAreXGkAr5fa09KcYndmOfVDMAOeMw+0G5oAGBifHeC/30AXGwCbqED/zJaJdcCMdY6k5w3mCX5JAAM3pyKMlf7jlzgjmlBL5t+cY8IsB8C7A+wZsANcNgM+TPeA+ZrA16PEqFiAk3+RQdwQarV4hmfAkRXoQR7gsAo8XzjADjDL52YkAz7VAPyr7NeckAJzr3CDAZx6dfcLLHLuEuN88wv1/vL3GygDJk6CnhsAeNEIsI0S9M2Gvz+60d464KPwc9ZR7N5KA/iCS0tHXHSX2AqamAEveX9yGRxgz4DNZ8B34wCbeB8wa6chfj/KsyTAI7Morz7ZNc70377ERljEHnCfNwVrI9vfiz+KgcMzNgMOswNcHuDTCsCb6R4w5/cce8b3R5sAp/8g8wEeMEN1khlwl3X1O7r9EID7QSvAe92F69EEwMEMwE8tAOdlwHe8g4/PkgATUOF+VucMnKvEKX2zA/z+isx0+3vxOwHcXp2QTwlhKr0Ho2fAg5lVSD8mjjbWAfNOtourut/LAgycg5U/1gYaqpMkqstKgDdYBmwA4JzdMr8qbx3bANjKHKwfE8f21gGfebczJ4cx58zvLwrg9IlRuWN1lQDMvlPFFO0aIAOemE9O7oM8yrH2ydM2StB3MwD/gIaVHjDvi3kP7HhYgLecWAZKXEKFGfCfTywh/v9UDzAyGk/gG6mrGeDgAFuYBm2lB4x+L9H5KAswcnOqbICXSgD+ZgZ4ir/Ia+UA91sTACcf5Z7ZAnGAeT9XOwA/ZUBs4n3A7M2G6/Hyrg0CBeg0gEdgzjOyyfU+KolQNfICHFGS7wcYwLRlwNAqLa5qs0/4s2O+1XUAbGYO1k9wWVkHzL4v84Ga8pUHMHBzqvyxNpT1vWgG/M+/HoHqAASYdG7Q4Iw7zKlAgd0zYPGo3OAsLDM9YO5nrfPFid9lFrfVCnAuIh0M4EXSqH+eR0TK+d//IQ/wznhq1WbAiTftfnGAqwCYMVO5no/zyv9PevGMkb2gBdr91/P7/596OIQWl6cAvAJDbm7c/BhQAH8hAd5THgjkASbV1z+GNgBOqyXvU5EE30vQfwZlRoA3gfPg3CdECGD4OuCj/Hf9qhG8fUvMv0oGGLmkcoJEzXoz4P/Nv2J6rhsQYMoI4CYpCODviVDu8QyYFWDxWca1H6CR9wHLtBvO8w+Ct1PMXwzAPS5uZkS/tUqAl8RD7DjMgQCMBQqzWurvsvUOcFGAH5YA3mz3gEUm3J3X837/3r7DvzPf73C/nw/BvU0TAEbuDpnLV84PXwbggQjw38P/v9g7oxxHkSYIn8Fq4QPsSM1zDwKfAyHz7kG0323JXP+f3dXqn9ntbkNmRlQmVT4AVBU4v4zIrGJFC/Svw4EDWNUETY7NPQPA3dlLB/ATsycDAFuKogUyQst22vs+APxwkMz8hsV6+QnhKxi+GwEsL/xNPADbqwKpkOuVAJ42jbAawgC4iQLg1a9tNx9iALgoYBIXvi5XGBapHxAgRtkHjDx29PYnhv9Y/rjFB7Ag5ErbbEdeiAYr4F8A325cYzyAD+g7eADweq98TumxFwCT9aX/FCHePmCx1RB+z1kBsFMF/H9QrRrgyASwqgmafFAFYaRzn3SGxYJGaaJ6cg/gOvMacPhPT24A8EwMudIuH8E/psPcqtMC+J8Y9lt9cU2O0/kG8LsrzafX6t2/+esYwF0BMKpDlQusvQFY7vVfswGwPJQJLLleBy0HAFYr4H/i+Kq850wF8GyQVwSwoNcN9b/LXRUAJwSw+11I+CHm8j1g64qDcwXcE0Nuj9QsQQBcjWv17+85jnMAN2EAvCpznPtDIAAfdg9g/DEX/kV6PvuA4xeBCQpY8GdE1WVDAfgngd/fz9uXGA9g/EZjFzXgNV7yB/x13AadgwI2BPAD9RjA8TujGjDkG71OAUwMuUwAz24B/DOOSeaN3ySEVpVeFPBzjHzc1VQAnFAB+2+Cho8xn7OgG8RplHsDsCDktqiAGQzAosYm1SahCpgehQPwUwk89x4avYsF/esvAIBPi3MA0/cBP3xkM64B3B54VGyB8o0F4AuPv5UdHytkKpYiMve4dOT9E/46BvD+FXCAJmhT2/QVUgPeKEKTmv1LJgA+H3hUFELxRfL8pPNCgV2tKtseDMhITdDK3WCDaB2OBcC7ADBsEoZt0EvuNeDgG5HWA7gnAvgN1jRjNy8U2NUrrANwgwUwnU06AH8Bki/6090CuN0/gAPsQjLNEj5iZU77gKNvRMIDWELFC4aJVAC3NACf7RziVZHzgpKU/gD86dvbzWc/W62KAoYYkksIACPWINA+4OiHYeEBPNnHCdN/fXwAD2QA9xkB+BMCd3PvswUpewAbKuAHDsCGom1C1IAn8povTh65YwBLi2kVEcB5KuB/r3DrGMD8wNwbr+7fJvzZaw9w9hb0LYE22R7gDEeZfQ04tge9+i0TN0FL3k9iCTg+gIeGC2BNXxPfnFU3o5//fXh1937uDzEB3BUAuwAweK9UXjVg09X0C2DmBwI7GxLlAeD/xDodgAfU00nUnqRvRq+632bfzWfQm1gA7AvAwDksvgEc53vA4T1oOIAlsUiIkMkVgDsWgE3JvyJyaq7P3yFr0Ixe/TLq7tzDUkECgA8FwA6aoE2RAakBs2ejU8DLLQMAX9wDWPanF3NycgLgwVZ6YwHMj8sW27Gr8/n9z998Pp9hL31RwM4AvABH+d1umI/sa8ChPejVACb2YAmDphDAqO5u9QeBpbNGA/gtUgnY7DyUn+w998isswDY4neCks1OAdsNcxc14G9uDAWvABY3QfNc4bHJEcCjcfH5OTsuoQDM2w2W1GkvFrQ5gO/IB+EbwPR9wA83T90rgFshTo48AA/cAO0DwB80TYEBrJnXmAmAiwJOBeBrDABjS9W51YAjn8WxGsDMUNRDiEgGMOdrDMcmEoCHAuAC4CAKuIYC2I4YC8KCZk9Gu9bXAuDkABb+5+fYAB74AI4Fpi4FgF+cArjdPYDtInE9hQXwNRyA1fX2294BLOSU6I8oi5nC+qIYV6MHAFcNHcCayzeZALgo4GQK2A5sU5BEoSjgJvA3CdfmefOBR0XZvY5kAENJpckC/AI4RVgm9cIVAO8NwI8g40TUgF/Z2cTiJ6HxCWBqE/RsxiKkBT3CrqwkGhjAimm9NAXAxYIOYkEvWADfgAA+kQWpAwVs2FZOBjC0L0pGxRgA9qCAR/v7Ip31MRcAe60BdwXAPpqgDYGBUMAPNoD1dsMpqgTGVtJEIVcW4hsygEcHAB7s7/sCSsWyAnCxoMMDuMYC2K5o6UAB/3CQ7UTdCrzWgka1CpsBuHIHYHzorwBtRyMQwEm49FYAvPrViA/ghRwYXQK4017zWzwFHHUr8MpeP6mqEq1lHwLAz5u+0jjQSvAfQalYsqhcAFyasIC1ufRSPb0CvjpQwFEl8ALFlGwXUo/hIR3A6H1IlazTRpfIdLhLgxqPSg04IwD/iALgk2cFHBHATQFwUgCPbAA/xwnagh4R1neFWq+cANx4BfDuLegTOTCmF2y76IK22PMVcyfSypn3KJVoFjEHfwAGK+BqMNeoBcDFgi414L+w9kA/CiCAtdeu7+ysZ/KU0lB/r1AAj1kDGLwReDR1ENZOK9gupCRt0Om+hps9gK1k0FYGpXNMa3sUbZ28Dws6pgS+QwE88AA8ZQfgAWN9TwXAuwVwWwDspAkaCuAmHIBNVvsaUQI/dgLgig/gKS2AqyYJgHvYlVG/AuBiQTsE8IIDsHZLztbJn3wo4JA7kdbNnLoNeN4LgLH7kIYkAO4KgL0WuwuAG7smrBteqxvptcUe7lsB3PkAcEQJvNJsaJlKQGRySnchKWTqpA13KJV1AYFdOadUQXmmA/joFcD7t6BPQKzlA2B61mPzunQFwMl2ISUA8JAUwEMDAvCIeBPyAvDoFcClCYu5L4ZDi48A/IMLYLUCtjL84x0IvXLmUgDzmmYGhwBGmp9fRbgC4N9+7wXAGVnQRli7hxnpYg+iV3YuURstd7wq8MpcRxh2ZbJ0PwCe08T42SeAUxmzHR3Ag1sAH3avgI2wRhj/DafVT1z5r84lzI4dO+0UwDMx5IZRwC9Pr/2Wps9WB+AjCsDJdCG7C8ttD1ZRwH62AZu1Qd/TA7ip3fSc3/YJ4DcmgLmiowUqOpz2GnHcr1CivgC4ADiKrqwJ478CAaxahfob/WPrKgAAIABJREFU2/m16zmP1gi9stnvQgy5nbkiBBHl+T1hpyBWA875rhBvwjrHAPRjd2Gd/QL4UADspAnazC4FAPjBBvBi9rpEa4R+7ATA8uPvWyCAYW3QR6DwhgE4WWWUfRr04BfARQF7aYKGAliHoe3yf/GT7wSrAt93AuAqRXROBuAn4a3DXVwzo2wAPBUApwPwEgbANmLtY1rqAEyn3qu7F8AXgLsLMeS2XAArkDKgEhftbHucgIsIYPJp0JVfALcFwG56sIz2zHwsHnUbgekAtlzuUFXgtWZDXwDsCcBNMgCHVMDkLqwXt/zNQQFfwwDYJlf4uHy62DM9CoBD7QWusZAS/QvnMAAeMcmEvv26AJiSB3nr9i4AtqoB1lOYXOFhf+nt/rt289c302UNJIHXdp/Jwm4VAcCKLyY8vylmH9IAWcJVfA94FDS7COzYgc7BgjaprNZNGADf7SF0Zy+6seEQSAKvNRvcA1hxylKPBDDC/Dw2BcC23KEW6IsC9g/ghTJUk0NDvtmvggCHrgB8iiOB7zb/W9O9QSJ6jD4BDKk+ohXfV8FTA+B0FjS1CDwWACfNtiz0z4MzVANQfMIuDYMk/vvNleGw7A3AUgXMA/A5SXCeUkT+KimAY1qzRAB7dqBzOIjDxNjlANhCrH9GSwWDbhN70WuHmQ2nB2s3AE6igFfcFXAIE9CxeJ5XxLSgmWdheXags1DAJxzVPCpgexEo8d+/31wBOEof1toXrWMC+I0MYEVwfm6q2rf/jHgAD7tTwMQPIo0FwIkBfOMJk/RW6cNeki70RTc3HKJsRVqbeXQXmFhLr4BnpNoxj/zrKqkXFEOCApjnQbt2oLOwoA2M3YU0VL1b/umxzQofQJR9qBb97vElYPwe2PgVw4LGfmLeOvKf0UnFk3sERRPNg3YtgLNQwAbG7itppAZifTInUE0HcG1fcj9dQwjg1RO/7BjAGpE6gFZOG9hg30MKWgOW1TV2J4DzALC+CHxnPY4bTKvLTVhZAVzj+UJK7hFM6PUT3zOAGyiA5yQCC/Y5hqgAZnnQvgVw02YBYC3WWCVgA0p8PtLv3I4ojeKsXb4FjkrAYh0XQwErYvPzMzFsu7Cqd/ycvswrNBdu9g/gtc+nKGDPHnRNexxAAC/mohpmO2BK7gFM6PUTlzl41e4BzP4k8Mjhzbg/BcwpAjsXwJkAeIkCYLVb/oWHKVWAwoKsxk3H7LoO0Am9fuItMeS27MinKdNOYBRKFxR1GGVYALcMCey8ApyJBa3G2oM30htKAIuJKCzIanB397m4fo7h2DmAW6jksZReQ8MB8OcPLiyAKR706B3AeShg7acBHrsYqfTSwqn88Fdy934cx4Zcp0Xpw49eStzuHHsAV0wAV+BFXEN6BcfS0mkuAjgXACs96Jo4dqVYByyCtCAr15u49XZuQi/weM4DcCoFzCwCV8OGSaG6sN4QF/XAHvLzSbQIhywArDMfF+JIr7iRChdBLEdvDtfbN4Hv8Og10gB8TBWaRzAKpauJ8qDnqABuzrl3YOWjgHXO7oM5VNwBFrJFqPkAvuNW13UZeNNSE0OuiIeqI/A1iER/nFca05TbnybAdRMDuEUL4KkA2MtiXFlxMS2AJ3v5J/eDrx7X23MZeNNSX4gKmA7gCzTsdkkEltJxHfcHYLAHHcCAzsaCVimfmjr0E87CPHHlv3jfE3S9F78E3rTUsuD1QhOkKgC3UC4aBf6KmFV8EUDjAhjchnVuIgA4EwXc+NsUY58qPJOOkksr5KjU98eW3P3uBt621LLgdaQFShWAuwNUApsE/s0RTXnX0T6dGJ3TZ/cGdEYAvpLiYkpALJM9ETVy9EoQgjsi8Laldg/gKVlkfsoVk+LjZnq1IA9aftljavwA27C8n0G58qXYDYAVHwMij/w7brvylStHZWIevt4npwTelujJRKJMl4qApXqMF6j2sVBeVUdx8ldM6hJXJAIl8BiCv/koYHlt9cEeqDRVqAGXVp1BImy7xrsh6DIwpd2854VcEYBVBcYZG3z1HrRkIVV3PQMum96lPWfO34wALI26ZAdaodVXsPLGlaNXpwkPmMC1qNFr61LLxMOEiBL2ANY1Kh+xl5cGeJXeGwCGenoAtyAJfJ6CADgbC1rchlXTB3rFDXSzDaBriCJ3fa2PhFAXun6I3rWtiUd74OnSHkHBhEVg9VkcsgqjQu9VkLVKjylMI3QVhb8ZKWCptfvgjxR3YtXWNdDSUDCThfKiIDXwIrr85kSPCeALG8Dg7zFo27CE0Qy0Y6iHXDWwBA7SgJUZgGXdr3QHWqrV1w10YTrQIjHPSXg6HIH/zCAEZYTtXkMPgpMROXT/+BZLR9SpGKi7VhgV6aBSCpDA1djEAfAhGwDLJPCyr4GeyDS8wYWgOB0DudDLXeT1C7rdLuaR3LZmqvrHK1g1weO+uMLYQkipKAL7l4D75m9OClikLFMIYJFWrxFE1NPw5DfhwWjgv/m7XQIL5i1jiOx/SO/CEhOyGuBxXxHLhHc9pxDWLBM61wbo/AB8vYUQwCLn9o64tH727KJzahe6XoQ51IMVzScaDnWBUNqoPE64GekrjDMkqbgkSCXcmtDj1AT65WRBCyRw/UjzVHDO7RYiWtBw45IvzNfE3oWuF2HmIUp1zjx9MPPlVQ/QiiayUXPGsOyuz56ZXEQOHhhkaUJXsfiblwKmGIMmv81V4AeCiAt/JlzH/2pM4F/ztU1WQ/1KE4kVL0jqJHALhqNUePFn9Tx2ihF29BCVLU3oUP5zdgDe6u3W91SPZQEJ4C1JiM3sN82Efezn+2LL30mYecjmLftMoOxW/I1IEqps6Y4SCi/tEQ/b77rC8ha7uD7C8pyr/s3qIA6BI/o/9u4mSVWkCwPwGnrgBu6EeRviOhzgAj4DnFsR5vY/tKrvX/mTQCaCPE/cQUcPSjKh8uUcMCu87KC7PZ/s0imPz/Y0ox+75921Bg4J+8+Hnjd7fZ901OPVCON/EanH6LqFY/2K/O2ewDEv9fbv4k6hB70uq1T5u56bhVXAHeuSj9cdaMjXKT+NO/rttDv+x177Rt46+NC7ixHGWswH/CaO/x5096g6ZB/Sanhg1TlumHrXkPtZxNBoJ0cAT6kJ/cL8XTenbIV6ZCKmev9s7J53R4dE21J+f4z77yn7uEf8M0Xjvwfd9SM7v53cfdlPscVSx25+XFN10zfBVtNYlpsECVzNZ/+r5bagu5SW4aXHecyWW3GlWRh/JC/q+J9TtKHD94OPLYGHvGqf+TnpsLQavCLuMq+/XTufaVqcnWYy9mz1LYGriSzL9dAEXs3m7y8suwKO/2uw4eO1Bxqy1U8xiZjyC1iRTd7XTfh2aAQXp3PvS60YcquzGSt/e3zU8LV9k3tcuxfkb6ewqTINJd0j7bFKwbd7/WqpARxbkL3oK8DdC6ge6/dx3PI/biQvnPBDeRr2IPjOW8xRl9qwN7/r0Wq4jiVwkg3x68xJ0mlM6V7xiR5Wh0/sE2CTemlpUBd6nuXvemkbcXwOOW5ZDC8/4LhvqfY5zueJmHb0USN56YSXxwH7YhWhuTfPp9z3Hd1isRpSJ3QqgdM8kItdlHv3HzsUownTqoz72G5VXec3iVdVM6nYqnu/C72a5ePfpVbAUS3RCeTvev1vyNW/fNYcTd0Nfp7Ar5/wUPR7H7oI9w/9eQIXQ2e6S+UzsE6oO6yIic7mZpc5G6PHlHYBq3bp72GqruXv1KrGTc8Enm/8LjSAIxI4TOJwn1dlp57H+fjrWOm7wU9Hcnr9hPf8A0mn85Bew/CZ3oy2TkVX2wlXxE1UNg64eOrYe5e0F+jTGni1z/pS9/Ti99oZ6BO/8/vy77Jb0BGFyd2e4sSOs/99wsM+fHH+GHsk4TyF6W5C5yI4PLlUHtf+RUixau3i1qnh13Qz2id1GN3A/mPU9GXocTZV8vZw/H4WU+s+/zoZVef4nXX+LrQCfrIPfygO0znOB4kQTh85ZiBk+f7V9sFIitN5IvO9DaFDHVyE572CR+NOdKFF9DMTJchmN173OXJ0q8EvWz9P4CxFVnl/YKuqX30am8BVtZ6qpupSx1dz7j4vOoAfPQUtzlM6QSFXn/zeDGQqRg/bYtIP3H/rlkd/ASxuqu4mcLKZfhYhq2QN1GfrxWp/SH4uH44uRdw/G1SuVf5O2LQ3S2W+m4nJVr9xrYG/7osmPZIUt7RvG8DlvaZoEc7Tuh7vVGRFGPp7dHMTxnb4HyOPJExtxo/HmNe228P+iDoDh9vjfvTyVtJFq9rXzXqkT2oyZFV59zPbLEnzsvWD3MqZV2VT/5XBq7amGzKm8ll8VVU99aKxiaqC24naH9azt9gK+FJbfn/ttV0Uw9QOtNyevq/gRYrU+v6D2+GXGYdye8bP0/s9OhzbOrg92gfpGzq8J9D+sNP3H5By2GVV3cuPxPXbeJ/0tFvbs1F7s3K8s+avEn7GrYG1NzStVWtX7dr/Gv5E8+75yXuK0k5LXVVPqviqfoP0XXYAX197DT9+rYzFj3AKkzxLxxB+3ynilKx42rYp89vPDcVH5hk//vGBRTGdp783jvUawsWPv7KzPeju6fnnuE/FKfl9XnPj/ZXLgpv+9+5WgXIJqoy/4eX3CE5cmZa3R9WMsWw15fXfOtG97+H23USeiyFjGVzdrX33Tbl+E5slB/C6PDThssierv/C8TjV89q0ydUe6OdhhnNIdgG2KfPf+FvH7PfHh3bG//dzIG0VeZjwr9KhvEzP18z/N0vF6Xg+dw+bpvl1nV1OYPqnV81lzfq59F4Kq0OTZ8UtL5+0+/qka912aJrMl84fn5llbJ/zt/oVV+0yP9NXfD6H8mss7WAune1Z1Yxl+TWK3c+Iulxq1b79/28TvwuvgD9X2W04ntt/5/XUf9u2x+uRHhOv3Yft5/g/ytFmfPs1kHn0w8r15YCPX7M05Eeds5zA31fe/b66Kq9PR/Od0bJuqvr6Sfv9fqTTePnMq022x5jNvv6av7qe+fu1Tf01lOry2DfrxZB3FPufwxjvUhPAAPDWlrkRBwCogAFAAAtgABgjgLWgAUAFDAACWAADQB4bAQwAKmAAEMACGADy0IIGABUwAAhgAQwAuQLYRhwAoAIGAAEsgAEgUwBrQQOAChgABLAABoA8bMQBACpgABDAAhgAMtGCBgAVMAAIYAEMALkC2EYcAKACBgABLIABIFMAa0EDgAoYAASwAAaAPGzEAQAqYAAQwAIYADLRggYAFTAACGABDAC5AthGHACgAgYAASyAASBTAGtBA4AKGAAEsAAGgDxsxAEAKmAAEMACGAAy0YIGABUwAAhgAQwAuQLYRhwAoAIGAAEsgAEgUwBrQQOAChgABLAABoA8bMQBACpgABDAAhgAMtGCBgAVMAAIYAEMALkC2EYcAKACBgABLIABIFMAa0EDgAoYAASwAAaAPGzEAQAqYAAQwAIYADLRggYAFTAACGABDAC5AthGHACgAgYAASyAASBTAGtBA4AKGAAEsAAGgDxsxAEAKmAAEMACGAAy0YIGABUwAAhgAQwAuQLYRhwAoAIGAAEsgAEgUwBrQQOAChgABLAABoA8bMQBACpgABDAAhgAMtGCBgAVMAAIYAEMALkC2EYcAKACBgABLIABIFMAa0EDgAoYAASwAAaAPGzEAQAqYAAQwAIYADLRggYAFTAACGABDAC5AthGHACgAp6FBoC5E8AzvGdp9lW1W/0DwIy9PJW0oLvVvnVVVS5bAAGsAh6z8m2EL4AAFsBjz1QtfQEEcDIbARzXe652rlYAAawCHrn5rPcMIIAF8Ohq1S+AANaCHj1+Vb8AAlgF7OEvAAL4/QO4Eb8AAthGHKPPju4zgABWAY//gFz+AghgATz+l492LlAAAawF7ctHAKiA3z6Ay0r+AghgATz628+1ixNAANuIY3RevwIQwCpgXz8CQAAvIIAb+QsggLWgx7dzYQIIYBWw/jMAAvj9A1j+AghgG3G8Yv8NVyWAAFYBy18ABPACArjeuSgBBLAW9NTuRwAQwCpg+QuAAH6HAPYCNIAAthGHF7AAUAEvIoDlL4AAFsAeAAPwzgG8EcB2gAYQwCpgDWgABPCSArhWAAMIYBtxaEADoAJeQgBrQAMIYAGsAQ3A2wfwPwLYN5AABLAKWAMaAAG8kADeKIABBLCNODSgAVABLyGAN65DAAEsgBXAACwggDcC2BtYAAJYBawABkAALyKAK1chgAC2EYc3sABQAS8hgHcuQgAB/H/27ii3bSMIwHCOUCKQ71EsqAuEzbtAi+8Cbd3/CLWtNnFsA6IcZjnkfN8JbIDAjxkuVwJsAAYgSYCb1AF2AgtAgE3APkECQIBzBNgADCDALuIwAANgAk4RYAMwgAALsCPQAOQJcJs4wI5AAwiwCdgbYAAEOEeADcAAeS2/hm3SBtgbYIC8diZgb4ABWIAAG4ABSDkBN1kD7AgWgACbgG2gARDgFAE2AAMIsIs4fIMEgAk4RYANwAACLMAGYACyBbjNGeC9Zw9AgE3ANtAAVA5wEWDfIAGQcQJuMgbYLVgAyd2ZgB3BAkCAkwTYBhogu8HPETqCBUDKAGecgA3AANn1AuwIFgAZA9wmDLANNEB6X03AjmABUN8owDbQANRnBb2Ak+cOQIBNwDbQANRXBNgRLACqCxClfBdxnDx3AALsEJYNNAALBNgK2hloAHIGuEkWYK+AAQjwY0j5JuCDxw4AAbaBBmABQ4AgJQuwDTQAIQKcbQI+eOoAEGAbaACSBrgVYADSGU3Alf/bk4cOgBBNShbgg6cOgAj3cCS7iMMGGoAoAU41AfsICQAB9hESAMsYrKBj/bMACLAJ2AYagD+kF+C6Tp45AIIEuE0UYB8hAfBiNAF7BQxAdTsB9hUwAEkD3CYK8MkzB8CTOxOwV8AALBDgIsBeAQNQXR8iwE2aAPsKGIBAAc4zAZ88cgAIsIugAVhGiEPQiVbQzmABcClSMQH7ChgAAd54gJ3BAuBFiK+QSpsmwCePHADPBhOwV8AACPDGA+wVMAAXoxW0AANQXYwzWHkmYGewABBg13AAsJQhSICbHAF2BguAWAFOMgH7KSQALnoB9goYgOpi3ASdZwUtwADECnCSCfjgkQPg2dciwAIMQHVBzmCVNkeAHYIG4KI3AbsHC4DqorwCFmAAcgW4WEH7LUIA8gY4yQQswAC8GATYGSwA6hvDBLhJEWBPHADBApxiAnYGC4BLjYoACzAA1Q3FCtpN0ABU15uAXUQJgAALMAAZhLkHK8tFHAIMwLOvxQTsKyQAqhsE2CFoAOqLs4EubYYAOwQNwEuLiglYgAEQ4K0H+OSZA6AJ9Qo4x0UcB88cAE2oV8ApJmC/hQTA0rOgAAOQ1rFYQYc66Q1ADn0xAfsMGIDaQm2gBRgAAXYRhwAD8MfcFROwezgAqK4XYPdwAFDdLlR/S7v9APsKCYB4AU4wAQswAE2seygFGIA0xmABbrYfYA8dAME+QsoxAXvqAIi2gRZgAHIYixW0ezgAqC3YGegUE7AAAxBuA50hwC7CAiDcBrq0AgzA9u1GE7CbKAGoLtwGOkOAD547gPT6YgUtwADUFm8DbQIGIIF4G2gBBiCBMWCAm60H2G8xAKS3KyZgEzAA1Q0CbAIGoP4A3BcraL/FAEBtd8UELMAAVNcL8BLOnjyA3AJ+BJziIg4/hgSQXMQjWBkmYL/FAJB8AO4F2AQMQP0Ah+xvaU3AAGxazA20FTQAGx+ARwEWYAAMwGku4hBgAAOwCViAAagb4CLAAgxAdaVYQS/0H548fQAGYBOwAANQUS/AAgyAATjTRRwCDJDXUEzAAgxA9QF4FGABBsAAbAUNgAHYBCzAAGQbgAUYAAOwizgEGIAcA7AJGAADsAALMAA5BuDSXgnwFwEGwAAswAIMwBYGYAEGYJsDcBFgAQagul6ABRgAA/D7ADcCDMDm+jsKsAADUN1QBFiAAag+APcCLMAAGIAFGIAMA/C4ggA/CjAAG+vvChbQJmAANmfKAnovwAIMwLwD8JTgnBcP8N8CDMCm+jvpBNZxFGABBmBGk/rbHk3AAgzAnAPwpNw8fBdgAQZgxv5Oerm7v188wPuDAAOwHdOu4HjszgIswABU7m+575b/VFiAAdiMaQvopwF4+QBfm4D/EmAAVtPffuoALMACDMBsJi6g913XjdFX0AIMwGr6O7E0j133fTQBCzAAs5h6udX+vuv+KQIswADMYXJnngbg7rsACzAAs/R36pe9zwOwAAswAPP0d5iahfNTfwN8BtwKMAAbMLm/LwPw8hdhlX0jwADk6W9pOwEWYABmMX3/XPYPz/39Z/nPgFsBBmD18+944wC8/FdIAgzA6vU3FOY+SoAfBRiAVdvdMP++fAMc4iukq3X6IsAAhDbckITLG+CuGwRYgAH4vfn3phevl/4G+Az46gpagAEI7HhTfy/fAIf4LSQTMABr7u9to+x/b4C7bvn+lqMAA7BWw41p+X8ADvAZsBU0AGu1u7W/PwbgAIegy0GAAVil463XSf54AxzgIkoBBiDJ+PtqAI5wCFqAAVhjfo/nm6vycwCOEOBrPwcswADEcxw+0ZSf/Q1wEeXVH0MSYADCjb/DZ97htl2oAM94FbQAA1Bl+j1/JiivFtAhDkHP+GNIAgzAHx9+j8dPnmA+/+xvhJugBRiANeX3/NkPiF4PwBEuorSCBmA9s+/589/vPrzqb4SLKMv5yv/7ZQMBfvTYAqzYYbc7HI/H4bf2xu3r/kZ4BTznTZRxA3wEYK36p/Kex98tyP5BgAHglnSW/X6G2r3ub4iLKOf8NUIBBiCm9v6XAEfo0ZwXYQkwADGn6F/7+z1Cj1oBBmDrzr/0N8SPAZuAAdi8Nwvo7luIqXzGz4AFGICA3iygY7wCvjoBCzAAK/fYBdxAX30HLMAArFvbvQ1wjD/LChqALTu/XUDHuIZDgAHYtoe3/Y1xDYcAA7Bpj+/628X4ww4CDMCG+/t+AI7xCrjM+RmwAAMQy/59f4NsoPcCDMB2+3v/vr/dEONPOwkwAFvt7wcvgINcw2EFDcB2tR/1N8Y1HFbQAGy3vx8toLtvQabzOQ9BCzAAcZw/7O+/7N1RbuM2GIXRWUK8Fo21gTp+F2L5PXCk/S+hTdAM0kESyVOK/CmeswIXDfDNpSg7ygn0JMAA7FL/eX+DnEALMAA77e/L6fMAB/l8AgzALvs7ft7f01OQDzimvIMlwAAE6e/0RX+jPAJeXMACDECFvuzvOUqKBgEGYHfmr/ob5GuwUr8GLMAARIjb8cv+hnkEvHQCLcAAVGf6ur/nKCUSYAAa6u/pHOVDHpO+hSTAAJTWf9ffMCfQAgxAQ/s3zLdwpP4eDgEGoPD+Hb/rb5wT6MVL0AIMQEXm7/sb5ls4BBiAXe3fy/f9jfJDDMlfAxZgAAqaFvp7+ivOPxUEGIC9zN/F/sY5gRZgAPZinpbyG+gEevEtJAEGoA7Ty2J/49yBXv4xwgcBBqCK+buiv4FOoLtBgAGoXr/09lG4AdwLMAD193dVfuP8EuGrZwEGoPL8Ttd1/Y10At0lvgQtwABkzu+8cv6GOoFO/haSAAOQ1fr8nk5zoM+d+NeABRiAvPm9o7+BXgIWYACq1c/zeDnd4SnSpxdgACrt7+qrV+9CffzEvwYswADkME/3nD3Hu4KV/jVgAQZg43TN8z/5vZzuFqpAi98ELcAAxMrv3SfP71ewQv13tBPg138wAVCzaRrH8Xz6U0+x/iGR+g5W2AC//l8DoFKX6XK5PJ7+j/OtrgW8mwD/PAHQsmuso/RJgAFowWOsAbz4TdACDIABvMEj4ORvIYUN8Is/PgADWIAtYAByOncCLMAAtD6Al+9gCTAABnB6z8nvYHkGDEA80QbwBpegLWAADGABFmAAAg7gXoABMID38FMMngEDEE24K9CbXIK2gAEI5toJsAADYAALMAAG8F7uYHkGDEAo54ADePEO1p4CbAEDtGnuAi7gDU6gBRgAA3ihv6MAA7Bzt4gDeGgpwC/+CAH0V4AtYAAyOIcM8BbfBC3AAARyDdnfSYAB0N+AX8OxqwC/+DsEaM3jTYAtYACym2P2t3ve4g6WAAMQRNAD6I3uYAkwADFEPYDe5osoPQMGIIioB9CtBdgCBtDfPd/BEmAAIgh7AL3R92AJMAD6K8CeAQM0Ku4B9PJvEVrAAOivAAswAGtdb4EDvNEdLAEGoLTHLvIAHhoL8Is/SIBGnLvQNrqDZQEDUHj/XkP3dxJgAHZpjj2Ap4MAA7BDT13tAf7hGTAA1bkG7+9md7AsYAAKCn7+vGYACzAA9m+Bn0ISYAD0t0CAHzwDBkB/Uz8Cft5qAFvAABRy6yoI8CDAAOzK402ABRiA7P2t4Px500vQngEDUMD5VkV/l78I+o/vYFnAAOQ3z50ACzAAeT1eK9m/3SzAAOynv7Xkd9Uj4AfPgAGoIr9z1+0pwD8sYAAqMM717N81LyEJMABVzN9bRf1d80XQAgxABfntu6r0Gz4C9gwYgEz5rer0+a2/44YD2AIGIEt+r3NXnUGAAajadOtu9fW3F2AAKt6+4zhXuH43fgvYM2AAtnQZp/nWVWpoMsA/L/5sAWou78s0vz32rTa/XffcZIC7GYBa3W7dfJvnmuP7egK96SPguAEGgB0/AhZgABBgAAiiHwQYAPIH+CDAABAywD8EGADS9ncUYADIb+NHwAIMAJ8t4G3fAhZgAPjMdBBgAIg4gB8EGAASD2ABBoD8jgcBBoDcVr2EJMAAkDjAw9Z3sAQYAP4owA8CDABpTQcBBoCIA1iAASC17R8BCzAA/G7NCbQAA0BiowADQP4BnOERsAADwG+OGR4BCzAA/Fef4xGwAAPAbwHOcQItwAAgwABQXJYTaAEGgAIBsQ/zAAAJ9ElEQVQDWIAB4D+OAgwA+eU5gRZgABBgAChs1SNgAQaAtP1dNYAfBBgAkgZ4zDOABRgAPgZ4EGAAyC7XCbQAA8AHgwADQP4BnOsEWoAB4EOADwIMALllewlJgAHgQ4CznUALMAD8Mh4EGACyD2ABBoACsr2EJMAA8Mu6O9ACDAD5B3CaE2gBBoD3AZzxBFqAAeBfx4MAA0BuOe9ACzAAvA/gQYABILsx5wm0AAPAmznrABZgAHgzCTAAFAhw1hNoAQaAV33eASzAALB+AAswACQdwHnvQAswALwN4Mwn0AIMAN3al4AFGACSehZgAMhu3e8wJHwELMAAsPYKVsIBLMAAsPYlYAEGgJTG7CfQAgwAK3+HQYABIOkAzn8CLcAAMOUfwAIMQPP6QYABIOoATnoCLcAAGMAFBrAAA2AACzAARB3AaU+gBRiA1gdwkRNoAQbAAC4wgAUYAANYgAEg8wAei1zBEmAAGg9woQEswAA07VhoAAswAE0bBBgAwg7g5CfQAgxAy0pdwRJgAJoewIMAA0Buq99BSn8CLcAAtGsqN4AFGIB2rR7AAgwA+QfwBifQAgxAq/qSA1iAAWjVseAVLAEGoFmr+yvAAJDMVPQEWoABaHUAl7yCJcAANOpYdgALMABN6tcPYAEGgPwDeJsTaAEGoEmlB7AAA9CiqfQAFmAADGABBoAc7ngC/CDAAJBGX34ACzAA7ZnKD2ABBqA9dwxgAQaAVAN4fX83O4EWYABa00cYwAIMQGuOEQawAAPQ3AA+CDAARB7ADwIMAGnEGMACDIABXGAACzAAbRliDGABBqAp/SHGABZgAFoyRRnAAgxAS/v3nhtYAgwAiQbwGOUEWoABMIALDGABBqChATyEGcACDIABXGAACzAABnCBASzA/M3evRvHDQRRFAUzGBgbym4eMAYJsID8QxDlyJEh4d/Tc04CrCKMW68BiQDdDOAp0AAWYAA6sS5joAEswAB0Yg41gAUYgD68a6gBLMAAdOGz6QssAQaAcwbwpv5ef4EWYAD6GMBjrAEswAD00N/3GGwACzAAHdj0RxhuGcACDEAHA3hbfwUYAE4ZwFO4C7QAA2AAPzCABRiA7N4b+3vLABZgALLv360H6CLAAJB0AAswAMktY8QBLMAApLb5AH3TABZgAHLv3xpzAAswAKkH8Nb+3jWABRiAxNatL4BvG8ACDEDi/bv5BfBtA1iAAUgc4Bp2AAswAHltPkDfN4AFGIC0+3f7AboIMAActPm/wLpzAAswAFkH8Pb+FgEGgGPW9xh5AAswADltfwF86wAWYAAy+sxT7AEswACk3L/bXwDfO4AFGICMA7hGH8ACDEDG/o7RB7AAA5DPjg+w7h7AAgyAAfzAABZgANLt3z39vXsACzAAyax77s+3D2ABBiCXXR9A3z+ABRiAXJY2+ivAAKTav40coAUYgFT93fcB1gMDWIABSGTf/n2ivwIMQJ79u7O/RYABYH9/3/v6+8gAFmAAstj5/veZASzAACTZv+vO/j4zgAUYgM77WwQYAPbae39+agALMAAZzLv7WwQYAPbZf39+bAALMADtW9rrrwAD0H5/l7G1A7QAA9C6I/fn5wawAAPQ+v5tsr8CDEC//S0CDAB77P37C48PYAEGoGHfR/bvowNYgAFo17tOrfZXgAFo1pHPnx8+QAswAK36fA7t34cHsAAD0Kj3sf37cH8FGIAmrYc+f378AC3AALSZ33ps/z4+gAUYgAbN89R4fwUYgOZ8jp6fnz9ACzAA7eV3eR3tbxFgANhmWaYE/RVgANrK7/Hzc4QDtAAD0JL1u57Q3yLAALDF0X98FKe/AgxAKz7zGfmNcYAWYABaye8JHz8HGsACDEAb3me8/Y3TXwEGoAXzSfmNcoAWYADiO+36HKi/AgxA+P6+61n5DXOAFmAAoue3npffQANYgAGIXN91mcaU/RVgAMLW9ye/9dT+FgEGgH+p85nH52D9FWAAQq7fdT25vrEO0AIMQLz4fv/U9/XT3ylxfwUYgGj9rcs8jWPu/SvAAISK77oudbxEEWAA+Nv6W6116qO/AgxAjO1bl6u2b8j+CjAAjw/f5brhG/QF8H8EeF4B4Bo/m7dO9VXreLUhoH8EuALA+V7TNN6ntBdgALjI67afFLK/AgxAdoMAA4D+CjAA+hv1M2gAaFoRYADQXwEGQH8FGACuMATm6QCgvwIMAF30V4ABSKoIMADYv77CAkB/BRgALlAEGAD0V4AB6MDQAo8JAP0VYAA4qAgwANi/AgyA/gowAFygNBPgLw8LAPtXgAEg//wVYADsXwEGgE72r6+wANBfAQaAvQYBBgD59RIYAP01gQHgfEWAAUB+3aAByG9olmcHgP1rAgNAD/kVYACaNbTNAwTA/jWBAaCH/AowAPLrBg0AneTXBAagNUMSniQA8ivAANBDfofhy+MEQH9NYADoIb8mMADyq8AA0El+HaEBkF8TGAA6ya8CAyC/jtAA8EcZsvOMAbB+HaEBoAxd8KABkF8FBkB+O/HlcQMgvzYwAOJrBQOA/EowAPIrwQBw2IAEA2D4SjAA8tsVvw8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPjVHhwSAAAAAAj6/9oXJgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAmAXUxmW2ubD3ewAAAABJRU5ErkJggg==";

const toNumberID_PDF = (v) => {
    if (v === null || v === undefined) return 0;
    const s = String(v).trim();
    if (!s) return 0;
    const cleaned = s.replace(/[^\d,.-]/g, "");
    const normalized = cleaned.replace(/\./g, "").replace(",", ".");
    const n = Number(normalized);
    return Number.isFinite(n) ? n : 0;
};

const toNumberVol_PDF = (v) => {
    if (v === null || v === undefined) return 0;
    let s = String(v).trim();
    if (!s) return 0;
    if (s.includes(",") && s.includes(".")) {
        s = s.replace(/\./g, "").replace(",", ".");
    } else if (s.includes(",")) {
        s = s.replace(",", ".");
    }
    const n = Number(s.replace(/[^\d.-]/g, ""));
    return Number.isFinite(n) ? n : 0;
};

const fetchRabData = async (kode_toko, no_ulok, lingkup) => {
    try {
        const url = new URL(`${API_BASE_URL}/api/rab`);
        url.searchParams.set("kode_toko", kode_toko);
        if (no_ulok) url.searchParams.set("no_ulok", no_ulok);
        if (lingkup) url.searchParams.set("lingkup", lingkup);
        const response = await fetch(url.toString());
        if (!response.ok) throw new Error("Gagal mengambil data RAB");
        return await response.json();
    } catch (error) {
        console.error(error);
        return [];
    }
};

const fetchPicList = async ({ noUlok, lingkup, kodeToko }) => {
    try {
        const url = new URL(`${API_BASE_URL}/api/pic-list`);
        url.searchParams.set("no_ulok", noUlok);
        if (lingkup) url.searchParams.set("lingkup", lingkup);
        if (kodeToko) url.searchParams.set("kode_toko", kodeToko);
        const res = await fetch(url.toString());
        if (!res.ok) return [];
        const json = await res.json();
        return Array.isArray(json.pic_list) ? json.pic_list : [];
    } catch (e) { return []; }
};

const fetchPicKontraktorData = async (noUlok) => {
    try {
        const res = await fetch(`${API_BASE_URL}/api/pic-kontraktor?no_ulok=${encodeURIComponent(noUlok)}`);
        if (!res.ok) return { pic_username: "N/A", kontraktor_username: "N/A" };
        const json = await res.json();
        return { pic_username: json.pic_username ?? "N/A", kontraktor_username: json.kontraktor_username ?? "N/A" };
    } catch (e) { return { pic_username: "N/A", kontraktor_username: "N/A" }; }
};

const fetchPicKontraktorOpnameData = async (noUlok) => {
    try {
        const res = await fetch(`${API_BASE_URL}/api/pic-kontraktor-opname?no_ulok=${encodeURIComponent(noUlok)}`);
        if (!res.ok) return { pic_username: "N/A", kontraktor_username: "N/A", name: "" };
        const json = await res.json();
        return {
            pic_username: json.pic_username ?? "N/A",
            kontraktor_username: json.kontraktor_username ?? "N/A",
            name: json.name ?? "",
        };
    } catch (e) { return { pic_username: "N/A", kontraktor_username: "N/A", name: "" }; }
};

const toBase64 = async (url) => {
    try {
        if (!url) return null;

        if (url.startsWith("data:image")) {
            return url;
        }

        if (url.startsWith('http') || url.startsWith('https')) {
            const proxyUrl = `${API_BASE_URL}/api/image-proxy?url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Proxy failed');
                const blob = await response.blob();
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            } catch (e) {
                console.warn("Proxy gagal, mencoba fetch langsung...", e);
                // Fallback fetch biasa di bawah
            }
        }

        const response = await fetch(url);
        if (!response.ok) throw new Error(`Status: ${response.status}`);
        
        const blob = await response.blob();
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
        });

    } catch (error) {
        console.error(`Gagal load gambar: ${url}`, error);
        return null;
    }
};

const groupDataByCategory = (data) => {
    const categories = {};
    data.forEach((item) => {
        const categoryName = (item.kategori_pekerjaan || "LAINNYA").toUpperCase();
        if (!categories[categoryName]) categories[categoryName] = [];
        categories[categoryName].push(item);
    });
    return categories;
};

const wrapText = (doc, text, maxWidth) => {
    const words = text.split(" ");
    const lines = [];
    let currentLine = "";
    for (let word of words) {
        const testLine = currentLine + (currentLine ? " " : "") + word;
        const textWidth = doc.getTextWidth(testLine);
        if (textWidth > maxWidth && currentLine) {
            lines.push(currentLine);
            currentLine = word;
        } else {
            currentLine = testLine;
        }
    }
    if (currentLine) lines.push(currentLine);
    return lines;
};

const PDFGenerator = {
    generateFinalOpnamePDF: async (submissions, selectedStore, selectedUlok, selectedLingkup, user) => {
        if (!window.jspdf) { alert("Library PDF belum dimuat."); return; }
        const { jsPDF } = window.jspdf;
        
        console.log("Memulai pembuatan PDF Full Version...");
        const doc = new jsPDF();
        const currentDate = new Date().toLocaleDateString("id-ID", { day: "2-digit", month: "long", year: "numeric" });
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 14;

        // --- PRELOAD LOGO ---
        let logoData = null;
        try { logoData = await toBase64(LOGO_URL_FALLBACK); } catch(e) {}

        // --- HELPER: Print Header (HANYA HALAMAN 1) ---
        const printHeader = () => {
            let currentY = 12;
            const logoW = 48; const logoH = 20;

            // 1. Logo Tengah
            if (logoData) {
                doc.addImage(logoData, "PNG", (pageWidth - logoW) / 2, currentY, logoW, logoH);
            }
            currentY += logoH + 6;

            // 2. Identitas Perusahaan
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(9).setFont("helvetica", "bold");
            doc.text(COMPANY_NAME, margin, currentY); 
            
            // Info Departemen
            currentY += 5;
            doc.setFont("helvetica", "normal");
            doc.text("BUILDING & MAINTENANCE DEPT", margin, currentY); 

            // Info Cabang
            const cabangTxt = selectedStore.cabang || selectedStore.nama_cabang || selectedStore.kota || "";
            if (cabangTxt) {
                currentY += 5;
                doc.text(`CABANG: ${cabangTxt}`, margin, currentY);
            }

            // Garis Pembatas Header
            currentY += 6;
            doc.setDrawColor(0); 
            doc.setLineWidth(0.5);
            doc.line(margin, currentY, pageWidth - margin, currentY);
            
            return currentY + 8; // Kembalikan posisi Y terakhir
        };

        // --- HELPER: Footer (Nomor Halaman) ---
        const addFooter = (pageNum) => {
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text(
                `Halaman ${pageNum} - Dicetak pada: ${new Date().toLocaleString("id-ID")}`,
                pageWidth / 2,
                pageHeight - 10,
                { align: "center" }
            );
            doc.setTextColor(0, 0, 0);
        };

        // --- HELPER: Print Summary Box ---
        const printSummaryBox = (label, totalReal, startY) => {
            const totalPembulatan = Math.floor(totalReal / 10000) * 10000;
            const ppn = totalPembulatan * 0.11;
            const grandTotal = totalPembulatan + ppn;

            doc.autoTable({
                body: [
                    [label, formatRupiah(totalReal)],
                    ["PEMBULATAN", formatRupiah(totalPembulatan)],
                    ["PPN 11%", formatRupiah(ppn)],
                    [`GRAND TOTAL ${label.replace("TOTAL ", "")}`, formatRupiah(grandTotal)]
                ],
                startY: startY,
                margin: { left: pageWidth - 95, right: 14 },
                tableWidth: 85,
                theme: "grid",
                styles: { fontSize: 9, halign: "right", cellPadding: 3 },
                columnStyles: { 0: { fontStyle: "bold", cellWidth: 35, halign: "left" } },
                didParseCell: (data) => {
                    if (data.row.index === 3) {
                        data.cell.styles.fillColor = [144, 238, 144]; // Hijau
                        data.cell.styles.fontStyle = "bold";
                    }
                }
            });
            
            return { finalY: doc.lastAutoTable.finalY + 15, grandTotal: grandTotal };
        };

        const lingkupFix = (selectedLingkup || "").toUpperCase();
        
        // --- FETCH DATA ---
        const rabData = await fetchRabData(selectedStore.kode_toko, selectedUlok, lingkupFix);
        const picKontraktorData = await fetchPicKontraktorData(selectedUlok);
        const fromOpname = await fetchPicKontraktorOpnameData(selectedUlok);
        
        // Fallback data nama PIC/Kontraktor
        if (fromOpname?.name && String(fromOpname.name).trim()) picKontraktorData.name = String(fromOpname.name).trim();
        if (!picKontraktorData.pic_username || picKontraktorData.pic_username === "N/A") {
            if (fromOpname?.pic_username) picKontraktorData.pic_username = String(fromOpname.pic_username).trim();
        }
        if (!picKontraktorData.kontraktor_username || picKontraktorData.kontraktor_username === "N/A") {
            if (fromOpname?.kontraktor_username) picKontraktorData.kontraktor_username = String(fromOpname.kontraktor_username).trim();
        }

        const picList = await fetchPicList({ noUlok: selectedUlok, lingkup: lingkupFix, kodeToko: selectedStore.kode_toko });

        // ==========================================
        // HALAMAN 1: HEADER & INFO
        // ==========================================
        
        // 1. Cetak Header (Hanya di Halaman 1)
        let lastY = printHeader();

        // 2. Judul Laporan
        doc.setFont("helvetica", "bold").setFontSize(14);
        doc.text(REPORT_TITLE, pageWidth / 2, lastY + 5, { align: "center" });
        lastY += 15;

        // 3. Info Proyek
        doc.setFont("helvetica", "normal").setFontSize(10);
        const dataOpname = submissions && submissions.length > 0 ? submissions[0] : {};
        const finalNamaToko = dataOpname.nama_toko || selectedStore.nama_toko || "-";
        const finalAlamat = dataOpname.alamat || selectedStore.alamat || "-";
        const picLine = picList && picList.length > 0 ? picList.join(", ") : (picKontraktorData.name || picKontraktorData.pic_username || "N/A");

        doc.text(`NOMOR ULOK : ${selectedUlok || "-"}`, margin, lastY); lastY += 6;
        doc.text(`LINGKUP PEKERJAAN : ${lingkupFix}`, margin, lastY); lastY += 6;
        doc.text(`NAMA TOKO : ${finalNamaToko}`, margin, lastY); lastY += 6;
        doc.text(`ALAMAT : ${finalAlamat}`, margin, lastY); lastY += 6;
        doc.text(`TANGGAL OPNAME : ${currentDate}`, margin, lastY); lastY += 6;
        doc.text(`NAMA PIC : ${picLine}`, margin, lastY); lastY += 6;
        doc.text(`NAMA KONTRAKTOR : ${picKontraktorData.kontraktor_username || "N/A"}`, margin, lastY); 
        lastY += 12;

        // --- DATA PREPARATION ---
        const rabPure = rabData.filter(item => !item.is_il);
        const rabIL = rabData.filter(item => item.is_il);
        
        let totalRealRAB = 0;
        let grandTotalRAB = 0;
        
        let totalRealIL = 0;
        let grandTotalIL = 0;

        // ==========================================
        // SECTION 1: RAB FINAL (Murni)
        // ==========================================
        doc.setFontSize(12).setFont("helvetica", "bold");
        doc.text("RAB FINAL", margin, lastY);
        doc.setDrawColor(120, 120, 120); doc.setLineWidth(0.3);
        doc.line(margin, lastY + 2, pageWidth - margin, lastY + 2);
        lastY += 10;

        const rabCategories = groupDataByCategory(rabPure);
        let categoryNumber = 1;

        if (rabPure.length === 0) {
            doc.setFontSize(10).setFont("helvetica", "italic");
            doc.text("Tidak ada data RAB awal.", margin, lastY);
            lastY += 10;
        } else {
            for (const categoryName of Object.keys(rabCategories)) {
                // Cek Page Break
                if (lastY + 40 > pageHeight - 20) { 
                    addFooter(doc.getNumberOfPages()); 
                    doc.addPage(); 
                    lastY = margin + 10; // Halaman baru tanpa Header Logo
                }
                
                doc.setFontSize(11).setFont("helvetica", "bold");
                doc.text(`${categoryNumber}. ${categoryName}`, margin, lastY);
                lastY += 10;
                categoryNumber++;

                let catMaterialTotal = 0;
                let catUpahTotal = 0;

                const categoryTableBody = rabCategories[categoryName].map((item, idx) => {
                    const volume = toNumberVol_PDF(item.volume);
                    const hargaMaterial = toNumberID_PDF(item.harga_material);
                    const hargaUpah = toNumberID_PDF(item.harga_upah);
                    const totalHarga = volume * (hargaMaterial + hargaUpah);

                    catMaterialTotal += (volume * hargaMaterial);
                    catUpahTotal += (volume * hargaUpah);
                    totalRealRAB += totalHarga;

                    return [
                        idx + 1, item.jenis_pekerjaan, item.satuan, volume.toFixed(2),
                        formatRupiah(hargaMaterial), formatRupiah(hargaUpah),
                        formatRupiah(volume * hargaMaterial), formatRupiah(volume * hargaUpah),
                        formatRupiah(totalHarga)
                    ];
                });

                categoryTableBody.push(["", "", "", "", "", "SUB TOTAL", formatRupiah(catMaterialTotal), formatRupiah(catUpahTotal), formatRupiah(catMaterialTotal + catUpahTotal)]);

                doc.autoTable({
                    head: [
                        ["NO.", "JENIS PEKERJAAN", "SATUAN", "VOLUME", { content: "HARGA SATUAN (Rp)", colSpan: 2, styles: { halign: "center" } }, { content: "TOTAL HARGA (Rp)", colSpan: 3, styles: { halign: "center" } }],
                        ["", "", "", "", "Material", "Upah", "Material", "Upah", "TOTAL HARGA (Rp)"]
                    ],
                    body: categoryTableBody,
                    startY: lastY,
                    margin: { left: margin, right: margin },
                    theme: "grid",
                    styles: { fontSize: 8, cellPadding: 2, lineWidth: 0.1 },
                    headStyles: { fillColor: [205, 234, 242], textColor: [0, 0, 0], fontSize: 8, fontStyle: "bold", halign: "center" },
                    columnStyles: { 0: { cellWidth: 8, halign: "center" }, 1: { cellWidth: 40 }, 8: { fontStyle: "bold", halign: "right" } },
                    didParseCell: (data) => {
                        if(data.section === 'body') {
                            if (data.row.index === data.table.body.length - 1) {
                                data.cell.styles.fillColor = [242, 242, 242];
                                if(data.column.index >= 5) data.cell.styles.fontStyle = 'bold';
                            }
                        }
                        if(data.column.index > 2) data.cell.styles.halign = 'right';
                    }
                });
                lastY = doc.lastAutoTable.finalY + 10;
            }
        }

        // Summary RAB
        if (lastY + 40 > pageHeight - 20) { 
            addFooter(doc.getNumberOfPages()); 
            doc.addPage(); 
            lastY = margin + 10; 
        }
        const summaryRAB = printSummaryBox("TOTAL RAB", totalRealRAB, lastY);
        lastY = summaryRAB.finalY;
        grandTotalRAB = summaryRAB.grandTotal;

        // ==========================================
        // SECTION 2: INSTRUKSI LAPANGAN (IL)
        // ==========================================
        if (rabIL.length > 0) {
            addFooter(doc.getNumberOfPages()); 
            doc.addPage(); 
            lastY = margin + 10; // Halaman Baru, tanpa Logo
            
            doc.setFontSize(12).setFont("helvetica", "bold");
            doc.text("INSTRUKSI LAPANGAN (IL)", margin, lastY);
            doc.setDrawColor(120, 120, 120); doc.setLineWidth(0.3);
            doc.line(margin, lastY + 2, pageWidth - margin, lastY + 2);
            lastY += 10;

            const ilCategories = groupDataByCategory(rabIL);
            let ilCatNumber = 1;

            for (const categoryName of Object.keys(ilCategories)) {
                if (lastY + 40 > pageHeight - 20) { 
                    addFooter(doc.getNumberOfPages()); 
                    doc.addPage(); 
                    lastY = margin + 10;
                }
                
                doc.setFontSize(11).setFont("helvetica", "bold");
                doc.text(`${ilCatNumber}. ${categoryName}`, margin, lastY);
                lastY += 10;
                ilCatNumber++;

                let catMaterialTotal = 0;
                let catUpahTotal = 0;

                const categoryTableBody = ilCategories[categoryName].map((item, idx) => {
                    const volume = toNumberVol_PDF(item.volume);
                    const hargaMaterial = toNumberID_PDF(item.harga_material);
                    const hargaUpah = toNumberID_PDF(item.harga_upah);
                    const totalHarga = volume * (hargaMaterial + hargaUpah);

                    catMaterialTotal += (volume * hargaMaterial);
                    catUpahTotal += (volume * hargaUpah);
                    totalRealIL += totalHarga;

                    return [
                        idx + 1, item.jenis_pekerjaan, item.satuan, volume.toFixed(2),
                        formatRupiah(hargaMaterial), formatRupiah(hargaUpah),
                        formatRupiah(volume * hargaMaterial), formatRupiah(volume * hargaUpah),
                        formatRupiah(totalHarga)
                    ];
                });

                categoryTableBody.push(["", "", "", "", "", "SUB TOTAL", formatRupiah(catMaterialTotal), formatRupiah(catUpahTotal), formatRupiah(catMaterialTotal + catUpahTotal)]);

                doc.autoTable({
                    head: [
                        ["NO.", "JENIS PEKERJAAN", "SATUAN", "VOLUME", { content: "HARGA SATUAN (Rp)", colSpan: 2, styles: { halign: "center" } }, { content: "TOTAL HARGA (Rp)", colSpan: 3, styles: { halign: "center" } }],
                        ["", "", "", "", "Material", "Upah", "Material", "Upah", "TOTAL HARGA (Rp)"]
                    ],
                    body: categoryTableBody,
                    startY: lastY,
                    margin: { left: margin, right: margin },
                    theme: "grid",
                    styles: { fontSize: 8, cellPadding: 2, lineWidth: 0.1 },
                    headStyles: { fillColor: [255, 245, 157], textColor: [0, 0, 0], fontSize: 8, fontStyle: "bold", halign: "center" },
                    columnStyles: { 0: { cellWidth: 8, halign: "center" }, 1: { cellWidth: 40 }, 8: { fontStyle: "bold", halign: "right" } },
                    didParseCell: (data) => {
                        if(data.section === 'body') {
                            if (data.row.index === data.table.body.length - 1) {
                                data.cell.styles.fillColor = [255, 249, 196];
                                if(data.column.index >= 5) data.cell.styles.fontStyle = 'bold';
                            }
                        }
                        if(data.column.index > 2) data.cell.styles.halign = 'right';
                    }
                });
                lastY = doc.lastAutoTable.finalY + 10;
            }

            if (lastY + 40 > pageHeight - 20) { 
                addFooter(doc.getNumberOfPages()); 
                doc.addPage(); 
                lastY = margin + 10;
            }
            const summaryIL = printSummaryBox("TOTAL IL", totalRealIL, lastY);
            lastY = summaryIL.finalY;
            grandTotalIL = summaryIL.grandTotal;
        }

        // ==========================================
        // SECTION 3: TAMBAH / KURANG
        // ==========================================
        if (submissions && submissions.length > 0) {
            const groupsByType = { "PEKERJAAN TAMBAH": [], "PEKERJAAN KURANG": [] };
            submissions.forEach(it => {
                const sel = toNumberVol_PDF(it.selisih);
                if (sel !== 0) {
                    const type = sel < 0 ? "PEKERJAAN KURANG" : "PEKERJAAN TAMBAH";
                    groupsByType[type].push(it);
                }
            });

            for (const [sectionName, itemsArr] of Object.entries(groupsByType)) {
                if (itemsArr.length === 0) continue;

                addFooter(doc.getNumberOfPages()); 
                doc.addPage(); 
                lastY = margin + 10; // Halaman Baru, tanpa Logo

                doc.setFontSize(12).setFont("helvetica", "bold");
                doc.text(sectionName, margin, lastY);
                doc.setDrawColor(180, 180, 180); doc.line(margin, lastY+2, pageWidth-margin, lastY+2);
                lastY += 10;

                const catGroups = groupDataByCategory(itemsArr);
                let kIdx = 1;

                for (const [kategori, kItems] of Object.entries(catGroups)) {
                    if (lastY + 20 > pageHeight - 20) { 
                        addFooter(doc.getNumberOfPages()); 
                        doc.addPage(); 
                        lastY = margin + 10;
                    }
                    
                    doc.setFontSize(11).setFont("helvetica", "bold");
                    doc.text(`${kIdx}. ${kategori}`, margin, lastY);
                    lastY += 10; kIdx++;

                    const rows = kItems.map((item, idx) => {
                        const sel = toNumberVol_PDF(item.selisih);
                        const hMat = toNumberID_PDF(item.harga_material);
                        const hUpah = toNumberID_PDF(item.harga_upah);
                        const deltaNominal = sel * (hMat + hUpah);
                        const namaPekerjaan = item.jenis_pekerjaan + (item.is_il ? " (IL)" : "");

                        return [
                            idx + 1, namaPekerjaan, item.vol_rab, item.satuan,
                            item.volume_akhir, `${item.selisih} ${item.satuan}`, formatRupiah(deltaNominal)
                        ];
                    });

                    doc.autoTable({
                        head: [["NO.", "JENIS PEKERJAAN", "VOL RAB", "SATUAN", "VOLUME AKHIR", "SELISIH", "NILAI SELISIH (Rp)"]],
                        body: rows,
                        startY: lastY,
                        margin: { left: margin, right: margin },
                        theme: "grid",
                        styles: { fontSize: 8, cellPadding: 3, lineWidth: 0.1 },
                        headStyles: { fillColor: [205, 234, 242], textColor: [0,0,0], fontSize: 8.5, fontStyle: "bold", halign: "center" },
                        columnStyles: { 6: { halign: "right", fontStyle: "bold" }, 2: { halign: "right" }, 4: { halign: "right" }, 5: { halign: "right" } },
                        didParseCell: (data) => {
                            if(data.section === 'body') {
                                const originalItem = kItems[data.row.index];
                                if (originalItem && originalItem.is_il) {
                                    data.cell.styles.fillColor = [255, 249, 196]; 
                                }
                            }
                        }
                    });
                    lastY = doc.lastAutoTable.finalY + 10;
                }

                const totalRealBlock = itemsArr.reduce((sum, item) => {
                    return sum + (toNumberVol_PDF(item.selisih) * (toNumberID_PDF(item.harga_material) + toNumberID_PDF(item.harga_upah)));
                }, 0);
                
                if (lastY + 40 > pageHeight - 20) { 
                    addFooter(doc.getNumberOfPages()); 
                    doc.addPage(); 
                    lastY = margin + 10;
                }
                const summaryBlock = printSummaryBox("TOTAL " + sectionName, totalRealBlock, lastY);
                lastY = summaryBlock.finalY;
            }
        }

        // ==========================================
        // SECTION 4: STATUS PEKERJAAN
        // ==========================================
        addFooter(doc.getNumberOfPages()); 
        doc.addPage(); 
        lastY = margin + 10; // Halaman Baru, tanpa Logo

        let totalTambah = 0; let totalKurang = 0;
        submissions.forEach(item => {
            const sel = toNumberVol_PDF(item.selisih);
            const unit = toNumberID_PDF(item.harga_material) + toNumberID_PDF(item.harga_upah);
            const delta = sel * unit;
            if (delta > 0) totalTambah += delta;
            else if (delta < 0) totalKurang += delta;
        });

        const totalTambahBulat = Math.floor(totalTambah / 10000) * 10000;
        const totalKurangBulat = Math.ceil(totalKurang / 10000) * 10000;
        const ppnTambah = totalTambahBulat * 0.11;
        const ppnKurang = totalKurangBulat * 0.11;
        const totalTambahPPN = totalTambahBulat + ppnTambah;
        const totalKurangPPN = totalKurangBulat + ppnKurang;
        
        const totalSetelahPPNRAB = grandTotalRAB + grandTotalIL;
        const deltaPPN = totalTambahPPN + totalKurangPPN;
        const totalSetelahPPNOpname = totalSetelahPPNRAB + deltaPPN;

        doc.setFontSize(12).setFont("helvetica", "bold");
        doc.text("STATUS PEKERJAAN", margin, lastY);
        doc.line(margin, lastY+2, pageWidth-margin, lastY+2);
        lastY += 10;

        const deltaNominal = totalSetelahPPNOpname - totalSetelahPPNRAB;
        let statusText = "Sesuai Target";
        if (deltaNominal > 0) statusText = "Pekerjaan Tambah";
        if (deltaNominal < 0) statusText = "Pekerjaan Kurang";

        const statusTableBody = [
            [{ content: `STATUS: ${statusText}`, colSpan: 2, styles: { fillColor: [245, 245, 245], fontStyle: "bold", fontSize: 12 } }],
            ["Total Awal (RAB + IL) incl. PPN", formatRupiah(totalSetelahPPNRAB)],
            ["Pekerjaan Tambah (incl. PPN)", formatRupiah(totalTambahPPN)],
            ["Pekerjaan Kurang (incl. PPN)", formatRupiah(totalKurangPPN)],
            ["Selisih Pekerjaan Tambah dan Kurang", `${deltaNominal >= 0 ? "+" : ""}${formatRupiah(deltaNominal)}`],
            ["Opname Final (incl. PPN)", formatRupiah(totalSetelahPPNOpname)]
        ];

        doc.autoTable({
            body: statusTableBody,
            startY: lastY,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 11, halign: "left", cellPadding: 4 },
            columnStyles: { 1: { halign: "right", cellWidth: 80 } },
            didParseCell: (data) => {
                if (data.row.index === statusTableBody.length - 1) {
                    data.cell.styles.fillColor = [144, 238, 144];
                    data.cell.styles.fontStyle = "bold";
                }
            }
        });
        lastY = doc.lastAutoTable.finalY + 15;

        // ==========================================
        // SECTION 5: LAMPIRAN FOTO
        // ==========================================
        const itemsWithPhotos = (submissions || []).filter(item => item.foto_url);
        if (itemsWithPhotos.length > 0) {
            addFooter(doc.getNumberOfPages()); 
            doc.addPage(); 
            let pageNum = doc.getNumberOfPages();
            
            // Header Foto (Tanpa Logo, hanya Judul)
            let photoY = margin + 10;

            doc.setFontSize(12).setFont("helvetica", "bold");
            doc.text("LAMPIRAN FOTO BUKTI", pageWidth / 2, photoY + 5, { align: "center" });
            doc.line(margin, photoY + 8, pageWidth - margin, photoY + 8);
            
            photoY += 15; 
            let columnIndex = 0;
            const columnWidth = (pageWidth - margin * 3) / 2;
            const leftColumnX = margin;
            const rightColumnX = margin + columnWidth + margin;

            const base64Photos = await Promise.all(itemsWithPhotos.map(it => toBase64(it.foto_url)));
            
            itemsWithPhotos.forEach((item, index) => {
                const imgData = base64Photos[index];
                if (imgData) {
                    const imgProps = doc.getImageProperties(imgData);
                    const maxWidth = columnWidth - 10;
                    const maxHeight = 80;
                    let imgWidth = maxWidth;
                    let imgHeight = (imgProps.height * imgWidth) / imgProps.width;
                    if (imgHeight > maxHeight) {
                        imgHeight = maxHeight;
                        imgWidth = (imgProps.width * imgHeight) / imgProps.height;
                    }

                    if (photoY + imgHeight + 35 > pageHeight - 20) {
                        addFooter(pageNum); 
                        doc.addPage(); 
                        pageNum++;
                        photoY = margin + 10 + 5; // Reset Y ke atas halaman baru
                        columnIndex = 0;
                    }

                    const currentX = columnIndex === 0 ? leftColumnX : rightColumnX;
                    
                    doc.setFontSize(9).setFont("helvetica", "bold");
                    const judulFoto = `${index+1}. ${item.jenis_pekerjaan}` + (item.is_il ? " (IL)" : "");
                    const titleLines = wrapText(doc, judulFoto, maxWidth);
                    let titleY = photoY;
                    titleLines.forEach(line => { doc.text(line, currentX, titleY); titleY += 5; });

                    const imageStartY = photoY + (titleLines.length * 5) + 2;
                    doc.setDrawColor(200); doc.rect(currentX, imageStartY, imgWidth + 4, imgHeight + 4);
                    doc.addImage(imgData, currentX + 2, imageStartY + 2, imgWidth, imgHeight);

                    if (columnIndex === 0) {
                        columnIndex = 1;
                    } else {
                        columnIndex = 0;
                        photoY = imageStartY + imgHeight + 25;
                    }
                }
            });
            addFooter(pageNum);
        } else {
            addFooter(doc.getNumberOfPages());
        }

        const totalPages = doc.getNumberOfPages();
        for (let i = 1; i < totalPages; i++) {
            doc.setPage(i);
        }

        doc.save(`BA_Opname_${selectedStore.kode_toko}_${selectedUlok}.pdf`);
        console.log("PDF selesai dibuat.");
    }
};

/* ======================== RENDERER (VIEW CONTROLLER) ======================== */
const Render = {
    app: () => {
        const app = document.getElementById('app');
        app.innerHTML = '';

        if (AppState.loading) {
            app.innerHTML = `
                <div class="loading-screen">
                    <div class="spinner"></div>
                    <h2 style="color: var(--primary);">Memuat Data...</h2>
                </div>`;
            return;
        }

        if (!AppState.user) {
            // Karena tidak ada form login lokal, redirect ke dashboard utama
            alert("Sesi Anda telah berakhir atau belum login. Silakan login kembali melalui Dashboard Utama.");
            window.location.href = "../../auth/index.html"; 
            return;
        }

        app.appendChild(Render.header());
        app.appendChild(Render.userInfo());

        const contentDiv = document.createElement('div');
        contentDiv.id = 'main-content';
        app.appendChild(contentDiv);

        switch (AppState.activeView) {
            case 'dashboard': Render.dashboard(contentDiv); break;
            case 'store-selection-pic': Render.storeSelection(contentDiv, 'opname'); break;
            case 'opname': Render.opnameForm(contentDiv); break;
            case 'final-opname-selection': Render.storeSelection(contentDiv, 'final-opname'); break;
            case 'final-opname-detail': Render.finalOpnameView(contentDiv); break;
            case 'store-selection-kontraktor': Render.storeSelection(contentDiv, 'approval'); break;
            case 'approval-detail': Render.approvalDetail(contentDiv, "Halaman Approval"); break;
            case 'history-selection-kontraktor': Render.storeSelection(contentDiv, 'history'); break;
            case 'history-detail-kontraktor': Render.finalOpnameView(contentDiv); break;
            default: Render.dashboard(contentDiv);
        }
    },

    header: () => {
        const header = document.createElement('header');
        header.className = 'app-header';
        
        header.innerHTML = `
            <img src="../../assets/Alfamart-Emblem.png" alt="Alfamart" class="header-logo" onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', '<b style=\\'position:absolute;left:20px;color:white\\'>ALFAMART</b>')">
            <div style="text-align:center;">
                <h1>Opname</h1>
            </div>
            <button class="header-logout" id="btn-logout">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                <span>Dashboard</span>
            </button>
        `;
        header.querySelector('#btn-logout').onclick = () => Auth.logout();
        return header;
    },

    userInfo: () => {
        const wrapper = document.createElement('div');
        wrapper.className = 'user-greeting-wrapper';
        const roleDisplay = AppState.user.role === 'pic' ? 'PIC' : 'Kontraktor';
        wrapper.innerHTML = `
            <div class="user-info">
                Semangat Pagi, ${AppState.user.username} | ${roleDisplay}
            </div>
        `;
        return wrapper;
    },

    // Render.login DIHAPUS karena sudah terintegrasi

    dashboard: (container) => {
        const role = AppState.user.role;
        let buttons = '';

        if (role === 'pic') {
            buttons = `
                <button onclick="AppState.activeView='store-selection-pic'; Render.app()" class="btn btn-primary d-flex flex-column align-center justify-center" style="height:140px; font-size:1.1rem; gap:12px;">
                    <span style="font-size:36px">ðŸ“</span> 
                    <span>Input Opname Harian</span>
                </button>
                <button onclick="AppState.activeView='final-opname-selection'; Render.app()" class="btn btn-success d-flex flex-column align-center justify-center" style="height:140px; font-size:1.1rem; gap:12px;">
                    <span style="font-size:36px">âœ…</span> 
                    <span>Lihat Opname Final</span>
                </button>
            `;
        } else if (role === 'kontraktor') {
            buttons = `
                <button onclick="AppState.activeView='store-selection-kontraktor'; Render.app()" class="btn btn-info d-flex flex-column align-center justify-center" style="height:140px; font-size:1.1rem; gap:12px;">
                    <span style="font-size:36px">ðŸ””</span> 
                    <span>Persetujuan Opname</span>
                </button>
                <button onclick="AppState.activeView='history-selection-kontraktor'; Render.app()" class="btn btn-secondary d-flex flex-column align-center justify-center" style="height:140px; font-size:1.1rem; gap:12px;">
                    <span style="font-size:36px">ðŸ“‚</span> 
                    <span>Histori Opname</span>
                </button>
            `;
        }

        container.innerHTML = `
            <div class="container" style="padding-top:40px;">
                <div class="card text-center" style="max-width:800px; margin:0 auto;">
                    <h2 style="color:var(--primary); margin-bottom:10px;">Selamat Datang, ${AppState.user.kontraktor_username || AppState.user.name || AppState.user.username}!</h2>
                    <p style="color:var(--text-muted); margin-bottom:30px;">Silakan pilih menu di bawah ini untuk memulai.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px;">
                        ${buttons}
                    </div>
                </div>
            </div>
        `;
    },

    storeSelection: async (container, type) => {
        container.innerHTML = `
            <div class="container text-center" style="padding-top:40px;">
                <div class="card">
                    <h3>Memuat Data Pekerjaan...</h3>
                    <div style="margin-top:10px; font-size:0.9rem; color:#666;">Sinkronisasi data Toko & RAB...</div>
                </div>
            </div>`;

        let url = "";
        const u = AppState.user;
        
        if ((type === 'opname' || type === 'final-opname') && u.role === 'pic') {
            url = `${API_BASE_URL}/api/toko?username=${u.username}`;
        } else if (u.role === 'kontraktor') {
            url = `${API_BASE_URL}/api/toko_kontraktor?username=${u.username}`;
        }

        try {
            const res = await fetch(url);
            const stores = await res.json();
            
            if (!Array.isArray(stores)) throw new Error("Gagal mengambil data toko.");

            const combinedList = [];

            stores.forEach(store => {
                if (store.no_uloks && Array.isArray(store.no_uloks) && store.no_uloks.length > 0) {
                    store.no_uloks.forEach(ulokNo => {
                        combinedList.push({
                            store: store,
                            ulok: ulokNo
                        });
                    });
                }
            });

            combinedList.sort((a, b) => {
                const nameCompare = a.store.nama_toko.localeCompare(b.store.nama_toko);
                if (nameCompare !== 0) return nameCompare;
                return a.ulok.localeCompare(b.ulok);
            });

            const renderList = (filter = "") => {
                const f = filter.toLowerCase();
                const filtered = combinedList.filter(item => 
                    item.store.nama_toko.toLowerCase().includes(f) || 
                    item.store.kode_toko.toLowerCase().includes(f) ||
                    item.ulok.toLowerCase().includes(f)
                );

                let html = `
                    <div class="container" style="padding-top:20px;">
                        <div class="card">
                            <div class="d-flex align-center gap-2" style="margin-bottom:24px; border-bottom:1px solid #eee; padding-bottom:16px;">
                                <button id="btn-back-store" class="btn btn-back">â† Dashboard</button>
                                <div>
                                    <h2 style="color:var(--primary); margin:0;">Pilih Pekerjaan</h2>
                                    <span style="font-size:0.9rem; color:#666;">Daftar Toko & ULOK (Sesuai RAB)</span>
                                </div>
                            </div>
                            
                            <div style="margin-bottom:24px;">
                                <input type="text" id="store-search" class="form-input" placeholder="ðŸ” Cari Toko atau No. ULOK..." value="${filter}">
                            </div>
                            
                            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:16px;">
                                ${filtered.map((item, idx) => `
                                    <button class="btn btn-secondary job-item" data-idx="${idx}" style="height:auto; min-height:110px; flex-direction:column; align-items:flex-start; text-align:left; padding:16px; border-left:5px solid var(--secondary-yellow); position:relative; overflow:hidden;">
                                        
                                        <div style="font-size:1.1rem; font-weight:700; color:var(--neutral-700); margin-bottom:4px;">
                                            ${item.store.nama_toko}
                                        </div>
                                        
                                        <div style="font-size:0.85rem; color:var(--text-muted); margin-bottom:12px;">
                                            Kode: <strong>${item.store.kode_toko}</strong>
                                        </div>

                                        <div class="badge badge-success" style="font-size:0.85rem; padding:6px 10px; background-color:#e0f2fe; color:#0284c7; border:1px solid #bae6fd;">
                                            ðŸ“„ ULOK: ${item.ulok}
                                        </div>
                                    </button>
                                `).join('')}
                            </div>
                            
                            ${filtered.length === 0 ? `
                                <div class="text-center" style="padding:40px; color:#666;">
                                    <div style="font-size:30px; margin-bottom:10px;">ðŸ“­</div>
                                    <p>Tidak ada data pekerjaan yang sesuai.</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.innerHTML = html;

                container.querySelector('#btn-back-store').onclick = () => { AppState.activeView = 'dashboard'; Render.app(); };
                
                const searchInput = document.getElementById('store-search');
                searchInput.oninput = (e) => { 
                    renderList(e.target.value); 
                    document.getElementById('store-search').focus(); 
                };

                container.querySelectorAll('.job-item').forEach((btn, index) => {
                    btn.onclick = () => {
                        const selectedItem = filtered[index];
                        AppState.selectedStore = selectedItem.store;
                        AppState.selectedUlok = selectedItem.ulok;
                        AppState.selectedLingkup = null; 

                        if (type === 'opname') AppState.activeView = 'opname';
                        else if (type === 'final-opname') AppState.activeView = 'final-opname-detail';
                        else if (type === 'approval') AppState.activeView = 'approval-detail';
                        else if (type === 'history') AppState.activeView = 'history-detail-kontraktor';
                        
                        Render.app();
                    };
                });
            };

            renderList();

        } catch (e) {
            console.error(e);
            container.innerHTML = `
                <div class="container" style="padding-top:40px;">
                    <div class="alert-error">
                        <h3>Gagal Memuat Data</h3>
                        <p>${e.message}</p>
                        <button class="btn btn-back" onclick="AppState.activeView='dashboard'; Render.app()" style="margin-top:10px;">Dashboard</button>
                    </div>
                </div>`;
        }
    },

    opnameForm: async (container) => {
        if (!AppState.selectedUlok) {
            AppState.activeView = 'store-selection-pic';
            Render.app();
            return;
        }

        if (!AppState.selectedLingkup) {
            container.innerHTML = `
                <div class="container" style="padding-top:40px;">
                    <div class="card text-center" style="max-width:600px; margin:0 auto;">
                        <h2 style="color:var(--primary);">Pilih Lingkup Pekerjaan</h2>
                        <div class="badge badge-success" style="margin:10px auto; display:inline-block;">ULOK: ${AppState.selectedUlok}</div>
                        
                        <div class="d-flex justify-center gap-2" style="margin-top:30px; margin-bottom:30px;">
                            <button class="btn btn-primary" id="btn-sipil" style="min-width:120px;">SIPIL</button>
                            <button class="btn btn-info" id="btn-me" style="min-width:120px;">ME</button>
                        </div>
                        <button class="btn btn-back" id="btn-cancel-lingkup">Kembali ke Daftar Toko</button>
                    </div>
                </div>
            `;
            
            container.querySelector('#btn-sipil').onclick = () => { AppState.selectedLingkup = 'SIPIL'; Render.opnameForm(container); };
            container.querySelector('#btn-me').onclick = () => { AppState.selectedLingkup = 'ME'; Render.opnameForm(container); };
            
            container.querySelector('#btn-cancel-lingkup').onclick = () => { 
                AppState.selectedStore = null;
                AppState.selectedUlok = null;
                AppState.activeView = 'store-selection-pic'; 
                Render.app(); 
            };
            return;
        }

        container.innerHTML = '<div class="loading-screen"><h3>Memuat Data...</h3></div>';
        
        try {
            const base = `${API_BASE_URL}/api/opname?kode_toko=${encodeURIComponent(AppState.selectedStore.kode_toko)}&no_ulok=${encodeURIComponent(AppState.selectedUlok)}&lingkup=${encodeURIComponent(AppState.selectedLingkup)}`;
            const res = await fetch(base);
            let data = await res.json();
            
            AppState.opnameItems = data.map((task, index) => {
                const volRab = toNumInput(task.vol_rab);
                const volAkhirNum = toNumInput(task.volume_akhir);
                const hargaMaterial = toNumID(task.harga_material);
                const hargaUpah = toNumID(task.harga_upah);
                
                const selisihNum = volAkhirNum - volRab;
                const total_harga = selisihNum * (hargaMaterial + hargaUpah);
                
                const alreadySubmitted = task.isSubmitted === true || !!task.item_id || ["PENDING", "APPROVED", "REJECTED"].includes(String(task.approval_status || "").toUpperCase());
                
                return { 
                    ...task, 
                    id: index + 1, 
                    harga_material: hargaMaterial, 
                    harga_upah: hargaUpah, 
                    isSubmitted: alreadySubmitted, 
                    volume_akhir: alreadySubmitted ? String(volAkhirNum) : "", 
                    selisih: (Math.round((selisihNum + Number.EPSILON) * 100) / 100).toFixed(2), 
                    total_harga,
                    catatan: task.catatan || "",
                    approval_status: task.approval_status || (alreadySubmitted ? "Pending" : "")
                };
            });

            

            let isFinalized = false;
            let canFinalize = false;
            let statusMessage = "Menunggu Approval Semua Item";

            // 1. Cek Data Server: Apakah Opname SUDAH Final (Locked)?
            try {
                const checkUrl = `https://sparta-backend-5hdj.onrender.com/api/check_status_item_opname?no_ulok=${AppState.selectedUlok}&lingkup_pekerjaan=${AppState.selectedLingkup}`;
                const statusRes = await fetch(checkUrl);
                const statusData = await statusRes.json();

                if (statusData.tanggal_opname_final) {
                    isFinalized = true;
                    statusMessage = "Opname Selesai (Final)";
                }
            } catch (err) {
                console.warn("Gagal cek status final:", err);
            }

            // 2. [LOGIKA BARU] Validasi Item di Tabel (Termasuk IL)
            // Tombol "Opname Final" hanya aktif jika SEMUA item di tabel statusnya 'APPROVED'
            if (!isFinalized) {
                const allItems = AppState.opnameItems;
                const totalItems = allItems.length;
                const approvedCount = allItems.filter(item => 
                    String(item.approval_status || "").toUpperCase() === "APPROVED"
                ).length;
                if (totalItems > 0 && totalItems === approvedCount) {
                    canFinalize = true;
                    statusMessage = "Opname Final";
                } else {
                    canFinalize = false;
                    statusMessage = `Menunggu Approval (${approvedCount}/${totalItems})`;
                }
            }

            const renderTable = () => {
                const items = AppState.opnameItems;
                
                // Hitung total awal untuk render pertama
                const totalVal = items.reduce((sum, i) => sum + (i.total_harga || 0), 0);
                const ppn = totalVal * 0.11;
                const grandTotal = totalVal * 1.11;

                let btnColor = '#6c757d'; 
                if (isFinalized) btnColor = '#28a745'; 
                else if (canFinalize) btnColor = '#007bff';

                const email = sessionStorage.getItem("loggedInUserEmail") || "";
                const cabang = sessionStorage.getItem("loggedInUserCabang") || "";
                
                // [MODIFIKASI] Logic Link IL dengan Parameter Auto-Fill
                const currentUlok = encodeURIComponent(AppState.selectedUlok || "");
                const currentToko = encodeURIComponent(AppState.selectedStore?.nama_toko || "");
                let ilParams = [`ulok=${currentUlok}`, `toko=${currentToko}`];

                if(email && cabang) {
                    try {
                        const token = btoa(JSON.stringify({ email, cabang }));
                        ilParams.push(`user=${token}`);
                } catch(e) { console.error("Gagal encode user IL", e); }
                }

                let ilLink = `../il/index.html?${ilParams.join('&')}`;

                let html = `
                <div class="container" style="padding-top:20px; padding-left:10px; padding-right:10px; max-width:100%;">
                    <div class="card" style="border-radius:0;">
                        <div class="d-flex align-center gap-2" style="margin-bottom:20px;">
                            <button id="btn-back-main" class="btn btn-back">â† Kembali</button>
                            <div>
                                <h2 style="color:var(--primary); margin:0;">Input Opname</h2>
                                <span style="color:#666;">${AppState.selectedStore.nama_toko} (ULOK: ${AppState.selectedUlok})</span>
                            </div>
                        </div>

                        <div class="table-container" style="overflow-x:auto;">
                            <table style="width:100%; min-width:1400px; border-collapse:collapse;">
                                <thead>
                                    <tr style="background:var(--primary); color:white;">
                                        <th style="padding:10px;">Kategori</th><th style="padding:10px;">Jenis Pekerjaan</th>
                                        <th class="text-center">Vol RAB</th><th class="text-center">Sat</th>
                                        <th class="text-right">H. Mat</th><th class="text-right">H. Upah</th>
                                        <th class="text-center">Vol Akhir</th><th class="text-center">Selisih</th>
                                        <th class="text-right">Total</th>
                                        <th class="text-center">Foto</th><th style="padding:10px;">Catatan</th>
                                        <th class="text-center">Status</th><th class="text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${items.map(item => {
                                        let rowBg = '';
                                        if (item.is_il) rowBg = '#fff9c4'; 
                                        else if (item.isSubmitted) rowBg = '#f0fff0';
                                        
                                        const selisihVal = parseFloat(item.selisih);
                                        let selisihColor = 'black';
                                        if (selisihVal < 0) selisihColor = 'red';
                                        else if (selisihVal > 0) selisihColor = 'green';

                                        return `
                                        <tr style="border-bottom:1px solid #ddd; background:${rowBg}">
                                            <td style="padding:10px;">
                                                ${item.kategori_pekerjaan}
                                                ${item.is_il ? '<br><span class="badge" style="background:#ffeb3b; color:#000; font-size:9px;">Instruksi Lapangan</span>' : ''}
                                            </td>
                                            <td style="padding:10px;">${item.jenis_pekerjaan}</td>
                                            <td class="text-center">${item.vol_rab}</td><td class="text-center">${item.satuan}</td>
                                            <td class="text-right">${formatRupiah(item.harga_material)}</td><td class="text-right">${formatRupiah(item.harga_upah)}</td>
                                            
                                            <td class="text-center">
                                                <input type="number" class="form-input vol-input" data-id="${item.id}" value="${item.volume_akhir}" 
                                                style="width:80px; text-align:center;" ${item.isSubmitted?'disabled':''}>
                                            </td>
                                            
                                            <td class="text-center font-bold" id="selisih-${item.id}" style="color:${selisihColor}">
                                                ${(item.volume_akhir!=='') ? item.selisih : '-'}
                                            </td>
                                            
                                            <td class="text-right font-bold" id="total-${item.id}" style="color:${item.total_harga<0?'red':'black'}">
                                                ${formatRupiah(item.total_harga)}
                                            </td>
                                            
                                            <td class="text-center">
                                                ${item.foto_url ? `<a href="${item.foto_url}" target="_blank">Lihat</a>` : 
                                                (!item.isSubmitted ? `<input type="file" class="file-input" data-id="${item.id}" id="f-${item.id}" hidden><label for="f-${item.id}" class="btn btn-sm btn-outline">Upload</label>`:'-')}
                                            </td>
                                            <td>${item.catatan||'-'}</td>
                                            <td class="text-center"><span class="badge badge-success">${item.approval_status||'-'}</span></td>
                                            <td class="text-center">
                                                ${!item.isSubmitted ? `<button class="btn btn-primary btn-sm save-btn" data-id="${item.id}">Simpan</button>` : 
                                                item.approval_status==='REJECTED' ? `<button class="btn btn-warning btn-sm perbaiki-btn" data-id="${item.id}">Perbaiki</button>` : 'Saved'}
                                            </td>
                                        </tr>
                                    `}).join('')}
                                </tbody>
                            </table>
                        </div>

                        ${!isFinalized ? `
                        <div style="margin-top: 20px; margin-bottom: 0px;">
                            <a href="${ilLink}" class="btn" 
                            style="width: 100%; background-color: #FFC107; font-weight: bold; color: #000; text-decoration: none; display: block; text-align: center; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                Instruksi Lapangan
                            </a>
                        </div>
                        ` : ''}

                        <div class="summary-box">
                            <div class="summary-row">
                                <span class="summary-label">Total</span> 
                                <span class="summary-value" id="summary-total" style="color:${totalVal<0?'#dc2626':'inherit'}">
                                    ${formatRupiah(totalVal)}
                                </span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">PPN (11%)</span> 
                                <span class="summary-value" id="summary-ppn" style="color:${ppn<0?'#dc2626':'inherit'}">
                                    ${formatRupiah(ppn)}
                                </span>
                            </div>
                            <div class="summary-divider"></div>
                            <div class="summary-row grand-total">
                                <span class="grand-total-label">Grand Total</span> 
                                <span class="grand-total-value" id="summary-grand" style="color:${grandTotal<0?'#dc2626':'var(--primary)'}">
                                    ${formatRupiah(grandTotal)}
                                </span>
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <button id="btn-final" class="btn" style="width:100%; padding:14px; font-size:1.1rem; font-weight:bold; 
                                background-color: ${btnColor}; color: white; cursor: ${(!canFinalize || isFinalized) ? 'not-allowed' : 'pointer'};" 
                                ${(!canFinalize || isFinalized) ? 'disabled' : ''}>
                                ${statusMessage}
                            </button>
                            ${!canFinalize && !isFinalized ? '<p style="text-align:center; color:#dc3545; font-size:0.85rem; margin-top:8px;">*Pastikan semua pekerjaan berstatus APPROVED untuk melakukan Opname Final.</p>' : ''}
                        </div>
                    </div>
                </div>`;
                
                container.innerHTML = html;
                
                // --- EVENT LISTENERS ---
                container.querySelector('#btn-back-main').onclick = () => { AppState.selectedLingkup = null; Render.opnameForm(container); };

                // LOGIKA BARU: Update DOM secara langsung tanpa render ulang tabel
                container.querySelectorAll('.vol-input').forEach(input => {
                    input.oninput = (e) => {
                        const id = parseInt(e.target.dataset.id);
                        const item = AppState.opnameItems.find(i => i.id === id);
                        
                        // 1. Update data di memory
                        item.volume_akhir = e.target.value;
                        const vAkhir = toNumInput(item.volume_akhir);
                        const vRab = toNumInput(item.vol_rab);
                        
                        const selisihNum = vAkhir - vRab;
                        item.selisih = selisihNum.toFixed(2);
                        item.total_harga = selisihNum * (item.harga_material + item.harga_upah);

                        // 2. Update Cell Selisih (Tanpa Render Ulang)
                        const selisihEl = document.getElementById(`selisih-${id}`);
                        if (selisihEl) {
                            selisihEl.innerText = item.selisih;
                            selisihEl.style.color = selisihNum < 0 ? 'red' : (selisihNum > 0 ? 'green' : 'black');
                        }

                        // 3. Update Cell Total Baris (Tanpa Render Ulang)
                        const totalEl = document.getElementById(`total-${id}`);
                        if (totalEl) {
                            totalEl.innerText = formatRupiah(item.total_harga);
                            totalEl.style.color = item.total_harga < 0 ? 'red' : 'black';
                        }

                        // 4. Hitung Ulang Summary Bawah
                        const newTotalVal = AppState.opnameItems.reduce((sum, i) => sum + (i.total_harga || 0), 0);
                        const newPpn = newTotalVal * 0.11;
                        const newGrandTotal = newTotalVal * 1.11;

                        // 5. Update DOM Summary Bawah (Tanpa Render Ulang)
                        const elSumTotal = document.getElementById('summary-total');
                        const elSumPpn = document.getElementById('summary-ppn');
                        const elSumGrand = document.getElementById('summary-grand');

                        if (elSumTotal) {
                            elSumTotal.innerText = formatRupiah(newTotalVal);
                            elSumTotal.style.color = newTotalVal < 0 ? 'red' : 'black';
                        }
                        if (elSumPpn) {
                            elSumPpn.innerText = formatRupiah(newPpn);
                            elSumPpn.style.color = newPpn < 0 ? 'red' : 'black';
                        }
                        if (elSumGrand) {
                            elSumGrand.innerText = formatRupiah(newGrandTotal);
                            elSumGrand.style.color = newGrandTotal < 0 ? 'red' : 'black';
                        }
                    }
                });

                container.querySelectorAll('.file-input').forEach(inp => {
                    inp.onchange = async (e) => {
                        const f = e.target.files[0];
                        if(!f) return;
                        const id = parseInt(e.target.dataset.id);
                        const fd = new FormData(); fd.append("file", f);
                        try {
                            const r = await fetch(`${API_BASE_URL}/api/upload`, { method:"POST", body:fd });
                            const d = await r.json();
                            AppState.opnameItems.find(i=>i.id===id).foto_url = d.link;
                            renderTable(); // Untuk upload foto, render ulang tidak masalah karena jarang dilakukan
                        } catch(err) { alert("Upload gagal"); }
                    }
                });

                container.querySelectorAll('.save-btn').forEach(btn => {
                    btn.onclick = async () => {
                        const id = parseInt(btn.dataset.id);
                        const item = AppState.opnameItems.find(i=>i.id===id);
                        if(!item.volume_akhir) { alert("Isi volume akhir!"); return; }
                        btn.innerText="..."; btn.disabled=true;
                        try {
                            const payload = {
                                kode_toko: AppState.selectedStore.kode_toko,
                                nama_toko: AppState.selectedStore.nama_toko,
                                pic_username: AppState.user.username,
                                no_ulok: AppState.selectedUlok,
                                kategori_pekerjaan: item.kategori_pekerjaan,
                                jenis_pekerjaan: item.jenis_pekerjaan,
                                vol_rab: item.vol_rab,
                                satuan: item.satuan,
                                volume_akhir: item.volume_akhir,
                                selisih: item.selisih,
                                foto_url: item.foto_url,
                                harga_material: item.harga_material,
                                harga_upah: item.harga_upah,
                                total_harga_akhir: item.total_harga,
                                lingkup_pekerjaan: AppState.selectedLingkup,
                                is_il: item.is_il
                            };
                            await fetch(`${API_BASE_URL}/api/opname/item/submit`, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload)});
                            item.isSubmitted=true; item.approval_status="Pending";
                            renderTable();
                        } catch(e) { alert(e.message); btn.disabled=false; btn.innerText="Simpan"; }
                    }
                });

                container.querySelectorAll('.perbaiki-btn').forEach(btn => {
                    btn.onclick = () => {
                        const id = parseInt(btn.dataset.id);
                        const item = AppState.opnameItems.find(i => i.id === id);
                        item.isSubmitted = false;
                        item.approval_status = "Pending";
                        item.volume_akhir = "";
                        item.selisih = "";
                        item.total_harga = 0;
                        renderTable();
                    }
                });

                if(canFinalize && !isFinalized) {
                    const bf = container.querySelector('#btn-final');
                    bf.onclick = async () => {
                        if(!confirm("Yakin finalisasi? Tidak bisa dibatalkan.")) return;
                        bf.innerText="Processing..."; bf.disabled=true;
                        try {
                            const r = await fetch(`https://sparta-backend-5hdj.onrender.com/api/opname_locked`, {
                                method:"POST", headers:{"Content-Type":"application/json"},
                                body:JSON.stringify({ status:"locked", ulok:AppState.selectedUlok, lingkup_pekerjaan:AppState.selectedLingkup })
                            });
                            const d = await r.json();
                            if(r.ok) { alert("Berhasil!"); isFinalized=true; canFinalize=false; Render.opnameForm(container); }
                            else { alert(d.message); bf.disabled=false; bf.innerText="Opname Final"; }
                        } catch(e) { alert(e.message); bf.disabled=false; }
                    }
                }
            };
            renderTable();

        } catch(e) { container.innerHTML=`<div class="alert-error">${e.message}</div>`; }
    },

    finalOpnameView: async (container) => {
        if (!AppState.selectedUlok) {
            if (AppState.user.role === 'pic') AppState.activeView = 'final-opname-selection';
            else AppState.activeView = 'history-selection-kontraktor';
            Render.app();
            return;
        }

        if (!AppState.selectedLingkup) {
            container.innerHTML = `
                <div class="container" style="padding-top:40px;">
                    <div class="card text-center" style="max-width:600px; margin:0 auto;">
                        <h2 style="color:var(--primary);">Pilih Lingkup Laporan</h2>
                        <div class="badge badge-success" style="margin:10px auto; display:inline-block;">ULOK: ${AppState.selectedUlok}</div>
                        
                        <div class="d-flex justify-center gap-2" style="margin-top:30px; margin-bottom:30px;">
                            <button class="btn btn-primary" id="btn-sipil-final" style="min-width:120px;">SIPIL</button>
                            <button class="btn btn-info" id="btn-me-final" style="min-width:120px;">ME</button>
                        </div>
                        <button class="btn btn-back" id="btn-cancel-lingkup-final">Kembali ke Daftar</button>
                    </div>
                </div>
            `;
            container.querySelector('#btn-sipil-final').onclick = () => { AppState.selectedLingkup = 'SIPIL'; Render.finalOpnameView(container); };
            container.querySelector('#btn-me-final').onclick = () => { AppState.selectedLingkup = 'ME'; Render.finalOpnameView(container); };
            
            container.querySelector('#btn-cancel-lingkup-final').onclick = () => { 
                AppState.selectedStore = null;
                AppState.selectedUlok = null;
                if (AppState.user.role === 'pic') {
                    AppState.activeView = 'final-opname-selection';
                } else {
                    AppState.activeView = 'history-selection-kontraktor';
                }
                Render.app();
            };
            return;
        }

        container.innerHTML = '<div class="container text-center" style="padding-top:40px;"><div class="card"><h3>Memuat Data Opname Final...</h3></div></div>';
        
        try {
            const url = `${API_BASE_URL}/api/opname/final?kode_toko=${encodeURIComponent(AppState.selectedStore.kode_toko)}&no_ulok=${encodeURIComponent(AppState.selectedUlok)}&lingkup=${encodeURIComponent(AppState.selectedLingkup)}`;
            
            const res = await fetch(url);
            const rawData = await res.json();
            const submissions = Array.isArray(rawData) ? rawData : [];

            if (submissions.length === 0) {
                 container.innerHTML = `
                    <div class="container" style="padding-top:40px;">
                        <div class="card text-center">
                            <div style="font-size:50px; margin-bottom:20px;">ðŸ“­</div>
                            <h2 style="color:#666;">Data Tidak Ditemukan</h2>
                            <p>Belum ada data opname <b>FINAL</b> untuk <b>${AppState.selectedLingkup}</b> di ULOK ini.</p>
                            <br>
                            <button class="btn btn-back" id="btn-back-empty">Kembali</button>
                        </div>
                    </div>
                `;
                container.querySelector('#btn-back-empty').onclick = () => { AppState.selectedLingkup = null; Render.finalOpnameView(container); };
                return;
            }

            const items = submissions.map((task, index) => {
                const volAkhirNum = toNumInput(task.volume_akhir);
                const hargaMaterial = toNumID(task.harga_material);
                const hargaUpah = toNumID(task.harga_upah);
                const total_harga = volAkhirNum * (hargaMaterial + hargaUpah);
                
                return { 
                    ...task, 
                    total_harga, 
                    vol_akhir_num: volAkhirNum, 
                    harga_satuan: hargaMaterial + hargaUpah 
                };
            });

            const totalBiaya = items.reduce((sum, i) => sum + i.total_harga, 0);

            const html = `
                <div class="container" style="padding-top:20px;">
                    <div class="card">
                        <div class="d-flex align-center gap-2" style="margin-bottom:20px; border-bottom:2px solid #eee; padding-bottom:15px; flex-wrap:wrap;">
                            <button id="btn-back-final-view" class="btn btn-back">â† Kembali</button>
                            <div style="flex:1;">
                                <h2 style="color:var(--primary); margin:0;">Riwayat Opname Final</h2>
                                <span style="font-size:0.9rem; color:#64748b;">
                                    ${AppState.selectedStore.nama_toko} â€¢ ULOK: ${AppState.selectedUlok} â€¢ ${AppState.selectedLingkup}
                                </span>
                            </div>
                            <button id="btn-download-pdf" class="btn btn-primary">
                                ðŸ“„ Download PDF
                            </button>
                        </div>

                        <div class="table-container">
                            <table style="width:100%;">
                                <thead>
                                    <tr style="background:#f1f5f9; color:#334155;">
                                        <th style="padding:12px;">Kategori</th>
                                        <th style="padding:12px;">Jenis Pekerjaan</th>
                                        <th class="text-center">Vol Akhir</th>
                                        <th class="text-center">Status</th>
                                        <th class="text-center">Tgl Submit</th>
                                        <th class="text-center">PIC</th>
                                        <th class="text-center">Kontraktor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${items.map((item, idx) => {
                                        // --- LOGIKA BARU: Warna Kuning untuk IL ---
                                        const rowBg = item.is_il ? '#fff9c4' : 'transparent';
                                        
                                        return `
                                        <tr style="border-bottom:1px solid #eee; background-color:${rowBg};">
                                            <td style="padding:12px; font-weight:600; color:#64748b;">
                                                ${item.kategori_pekerjaan}
                                                ${item.is_il ? '<br><span class="badge" style="background:#ffeb3b; color:#000; font-size:9px;">Instruksi Lapangan</span>' : ''}
                                            </td>
                                            <td style="padding:12px;">${item.jenis_pekerjaan}</td>
                                            <td class="text-center font-bold">
                                                ${item.volume_akhir} ${item.satuan}
                                            </td>
                                            <td class="text-center">
                                                <span class="badge badge-success" style="font-size:11px;">${item.approval_status || 'Approved'}</span>
                                            </td>
                                            <td class="text-center" style="font-size:0.9rem;">
                                                ${item.tanggal_submit || '-'}
                                            </td>
                                            <td class="text-center" style="font-size:0.9rem;">
                                                ${item.pic_name || item.pic_username || '-'}
                                            </td>
                                            <td class="text-center" style="font-size:0.9rem;">
                                                ${item.kontraktor_name || item.display_kontraktor || item.kontraktor_username || '-'}
                                            </td>
                                        </tr>
                                    `}).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div style="margin-top:20px; background:#f8fafc; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                            <div class="d-flex justify-between" style="max-width:400px; margin-left:auto;">
                                <span>Total Estimasi:</span> 
                                <strong>${formatRupiah(totalBiaya)}</strong>
                            </div>
                        </div>

                    </div>
                </div>
            `;
            container.innerHTML = html;

            container.querySelector('#btn-back-final-view').onclick = () => { AppState.selectedLingkup = null; Render.finalOpnameView(container); };
            
            container.querySelector('#btn-download-pdf').onclick = () => {
                const btn = document.getElementById('btn-download-pdf');
                btn.innerText = "Memproses PDF...";
                btn.disabled = true;
                setTimeout(() => {
                    PDFGenerator.generateFinalOpnamePDF(items, AppState.selectedStore, AppState.selectedUlok, AppState.selectedLingkup, AppState.user);
                    btn.innerText = "ðŸ“„ Download PDF";
                    btn.disabled = false;
                }, 500);
            };

        } catch (e) {
            container.innerHTML = `<div class="container"><div class="alert-error">Error memuat data final: ${e.message}</div><button class="btn btn-back" onclick="Render.app()">Kembali</button></div>`;
        }
    },
    
    approvalDetail: async (container) => {
        if (!AppState.selectedUlok) {
            AppState.activeView = 'store-selection-kontraktor';
            Render.app();
            return;
        }

        if (!AppState.selectedLingkup) {
            container.innerHTML = `
                <div class="container" style="padding-top:40px;">
                    <div class="card text-center" style="max-width:600px; margin:0 auto;">
                        <h2 style="color:var(--primary);">Pilih Lingkup Pekerjaan</h2>
                        <div class="badge badge-success" style="margin:10px auto; display:inline-block;">ULOK: ${AppState.selectedUlok}</div>
                        
                        <div class="d-flex justify-center gap-2" style="margin-top:30px; margin-bottom:30px;">
                            <button class="btn btn-primary" id="btn-sipil" style="min-width:120px;">SIPIL</button>
                            <button class="btn btn-info" id="btn-me" style="min-width:120px;">ME</button>
                        </div>
                        <button class="btn btn-back" id="btn-cancel-lingkup">Kembali ke Daftar Approval</button>
                    </div>
                </div>
            `;
            
            container.querySelector('#btn-sipil').onclick = () => { AppState.selectedLingkup = 'SIPIL'; Render.approvalDetail(container); };
            container.querySelector('#btn-me').onclick = () => { AppState.selectedLingkup = 'ME'; Render.approvalDetail(container); };
            
            container.querySelector('#btn-cancel-lingkup').onclick = () => { 
                AppState.selectedStore = null;
                AppState.selectedUlok = null;
                AppState.activeView = 'store-selection-kontraktor'; 
                Render.app(); 
            };
            return;
        }

        container.innerHTML = '<div class="container text-center" style="padding-top:40px;"><div class="card"><h3>Memuat Data Opname Pending...</h3></div></div>';
        
        try {
            const url = `${API_BASE_URL}/api/opname/pending?kode_toko=${AppState.selectedStore.kode_toko}&no_ulok=${AppState.selectedUlok}&lingkup=${AppState.selectedLingkup}`;
            const res = await fetch(url);
            const rawData = await res.json();
            const pendingItems = Array.isArray(rawData) ? rawData : [];
            
            const renderApprovalTable = () => {
                let html = `
                <div class="container" style="padding-top:20px; max-width: 100vw; padding-left: 16px; padding-right: 16px;">
                    <div class="card" style="border-radius:12px; padding:16px;">
                        <div class="d-flex align-center gap-2" style="margin-bottom:24px; flex-wrap:wrap;">
                            <button id="btn-back-lingkup" class="btn btn-back">â† Kembali</button>
                            <h2 style="color:var(--primary);">Persetujuan Opname</h2>
                        </div>
                        <p style="margin-bottom:20px; color:#64748b;">
                            <strong>${AppState.selectedStore.nama_toko}</strong> | ULOK: ${AppState.selectedUlok} | Lingkup: ${AppState.selectedLingkup}
                        </p>

                        <div id="approval-message" style="display:none; padding:10px; border-radius:8px; margin-bottom:15px;"></div>

                        <div class="table-container">
                            <table style="width:100%; min-width:1000px;">
                                <thead>
                                    <tr style="background:#f2f2f2;">
                                        <th style="padding:12px;">Kategori</th>
                                        <th style="padding:12px;">Jenis Pekerjaan</th>
                                        <th style="padding:12px; text-align:center;">Volume Akhir</th>
                                        <th style="padding:12px; text-align:center;">Foto</th>
                                        <th style="padding:12px;">PIC</th>
                                        <th style="padding:12px;">Waktu Submit</th>
                                        <th style="padding:12px; min-width:200px;">Catatan</th>
                                        <th style="padding:12px; text-align:center; min-width:180px;">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="approval-tbody">
                                    ${pendingItems.length === 0 ? 
                                        '<tr><td colspan="8" class="text-center" style="padding:20px;">Tidak ada opname yang menunggu persetujuan.</td></tr>' : 
                                        pendingItems.map(item => `
                                        <tr id="row-${item.item_id}" style="border-bottom:1px solid #ddd;">
                                            <td>${item.kategori_pekerjaan}</td>
                                            <td>${item.jenis_pekerjaan}</td>
                                            <td class="text-center"><b>${item.volume_akhir}</b> ${item.satuan || ''}</td>
                                            <td class="text-center">
                                                ${item.foto_url ? `<a href="${item.foto_url}" target="_blank" class="btn btn-outline" style="padding:4px 8px; font-size:12px;">Lihat</a>` : '<span style="color:#999;">-</span>'}
                                            </td>
                                            <td>${item.name || '-'}</td>
                                            <td>${item.tanggal_submit || '-'}</td>
                                            <td>
                                                <textarea id="note-${item.item_id}" class="form-input" rows="2" placeholder="Catatan (opsional)..." style="font-size:0.9rem;"></textarea>
                                            </td>
                                            <td class="text-center">
                                                <div class="d-flex justify-center gap-2">
                                                    <button class="btn btn-success btn-approve" data-id="${item.item_id}" data-jenis="${item.jenis_pekerjaan}" style="padding:6px 12px; font-size:0.85rem;">Approve</button>
                                                    <button class="btn btn-primary btn-reject" data-id="${item.item_id}" style="padding:6px 12px; font-size:0.85rem; background-color:#dc3545;">Reject</button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>`;
                
                container.innerHTML = html;

                container.querySelector('#btn-back-lingkup').onclick = () => { 
                    AppState.selectedLingkup = null; 
                    Render.approvalDetail(container); 
                };

                const showMsg = (msg, isError = false) => {
                    const el = document.getElementById('approval-message');
                    el.style.display = 'block';
                    el.className = isError ? 'alert-error' : 'badge-success'; 
                    el.style.backgroundColor = isError ? '#ffe5e5' : '#dcfce7';
                    el.style.color = isError ? '#cc0000' : '#166534';
                    el.innerText = msg;
                    setTimeout(() => { el.style.display = 'none'; }, 3000);
                };

                container.querySelectorAll('.btn-approve').forEach(btn => {
                    btn.onclick = async () => {
                        const itemId = btn.dataset.id;
                        const jenisPekerjaan = btn.dataset.jenis;
                        const noteVal = document.getElementById(`note-${itemId}`).value;
                        const row = document.getElementById(`row-${itemId}`);
                        const btnReject = row.querySelector('.btn-reject');

                        btn.disabled = true; btn.innerText = '...'; btnReject.disabled = true;

                        try {
                            const payload1 = {
                                item_id: itemId,
                                kontraktor_username: AppState.user.username || AppState.user.name,
                                catatan: noteVal
                            };

                            const res1 = await fetch(`${API_BASE_URL}/api/opname/approve`, {
                                method: "PATCH",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(payload1)
                            });
                            
                            if (!res1.ok) {
                                const errData = await res1.json();
                                throw new Error(errData.message || "Gagal approve item");
                            }

                            await new Promise(r => setTimeout(r, 2000));

                            const payload2 = {
                                no_ulok: AppState.selectedUlok,
                                lingkup_pekerjaan: AppState.selectedLingkup,
                                jenis_pekerjaan: jenisPekerjaan
                            };

                            const res2 = await fetch(`https://sparta-backend-5hdj.onrender.com/api/process_summary_opname`, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(payload2)
                            });

                            if (!res2.ok) {
                                const errData2 = await res2.json();
                                console.warn("Warning Summary:", errData2.message);
                            }

                            showMsg("Berhasil di-approve!");
                            row.remove();

                            if(document.querySelectorAll('#approval-tbody tr').length === 0) {
                                document.getElementById('approval-tbody').innerHTML = '<tr><td colspan="8" class="text-center" style="padding:20px;">Semua data telah diproses.</td></tr>';
                            }

                        } catch (e) {
                            showMsg(`Error: ${e.message}`, true);
                            btn.disabled = false; btn.innerText = 'Approve'; btnReject.disabled = false;
                        }
                    };
                });

                container.querySelectorAll('.btn-reject').forEach(btn => {
                    btn.onclick = async () => {
                        const itemId = btn.dataset.id;
                        const noteVal = document.getElementById(`note-${itemId}`).value;
                        const row = document.getElementById(`row-${itemId}`);
                        const btnApprove = row.querySelector('.btn-approve');

                        if(!confirm("Yakin ingin menolak (REJECT) item ini?")) return;

                        btn.disabled = true; btn.innerText = '...'; btnApprove.disabled = true;

                        try {
                            const payload = {
                                item_id: itemId,
                                kontraktor_username: AppState.user.username || AppState.user.name,
                                catatan: noteVal
                            };

                            const res = await fetch(`${API_BASE_URL}/api/opname/reject`, {
                                method: "PATCH",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(payload)
                            });

                            if (!res.ok) {
                                const data = await res.json();
                                throw new Error(data.message || "Gagal reject");
                            }

                            showMsg("Berhasil di-reject!");
                            row.remove();

                            if(document.querySelectorAll('#approval-tbody tr').length === 0) {
                                document.getElementById('approval-tbody').innerHTML = '<tr><td colspan="8" class="text-center" style="padding:20px;">Semua data telah diproses.</td></tr>';
                            }

                        } catch (e) {
                            showMsg(`Error: ${e.message}`, true);
                            btn.disabled = false; btn.innerText = 'Reject'; btnApprove.disabled = false;
                        }
                    };
                });
            };

            renderApprovalTable();

        } catch (e) {
            container.innerHTML = `<div class="container"><div class="alert-error">Gagal mengambil data pending: ${e.message}</div><button class="btn btn-back" onclick="AppState.selectedLingkup=null; Render.approvalDetail(document.getElementById('main-content'))">Kembali</button></div>`;
        }
    },
};

/* ======================== INIT ======================== */
window.addEventListener('DOMContentLoaded', () => {
    Auth.init();
});